<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanremo - Eisproduktionsmanagement</title>
    <style>
        /* ===== VARIABLES & RESET ===== */
        :root {
            /* Colors */
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #16a34a;
            --success-dark: #15803d;
            --danger: #dc2626;
            --danger-dark: #b91c1c;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --muted: #6b7280;
            --light: #f9fafb;
            --dark: #1f2937;
            --border: #e5e7eb;
            --border-dark: #d1d5db;
            --card-bg: #ffffff;
            --body-bg: #f3f4f6;
            
            /* Spacing */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 18px;
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            
            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.1);
            
            /* Typography */
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 30px;
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            line-height: 1.5;
            overflow-x: hidden;
        }
        
        /* ===== LAYOUT ===== */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: var(--light);
            box-shadow: var(--shadow-xl);
        }
        
        /* ===== HEADER ===== */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: var(--space-md) var(--space-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .logo-icon {
            font-size: 28px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .logo-text {
            font-size: var(--font-size-xl);
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .logo-subtitle {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            font-weight: 500;
        }
        
        /* ===== MAIN NAVIGATION ===== */
        .main-nav {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.1);
            padding: var(--space-sm);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
        }
        
        .nav-btn {
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            border: 2px solid transparent;
            border-radius: var(--radius-md);
            color: white;
            font-weight: 700;
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            white-space: nowrap;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .nav-btn i {
            font-size: 18px;
        }
        
        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            padding: var(--space-lg);
            overflow-y: auto;
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .view-container {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .view-container.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== DASHBOARD VIEW ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: var(--space-md);
        }
        
        .stat-icon.order { background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%); color: white; }
        .stat-icon.production { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; }
        .stat-icon.recipe { background: linear-gradient(135deg, #34d399 0%, #10b981 100%); color: white; }
        .stat-icon.label { background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); color: white; }
        
        .stat-value {
            font-size: var(--font-size-2xl);
            font-weight: 800;
            color: var(--dark);
            margin: var(--space-xs) 0;
        }
        
        .stat-label {
            color: var(--muted);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }
        
        .stat-change {
            font-size: var(--font-size-xs);
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 20px;
            margin-top: var(--space-sm);
            display: inline-block;
        }
        
        .stat-change.positive { background: #dcfce7; color: #166534; }
        .stat-change.negative { background: #fee2e2; color: #991b1b; }
        
        /* ===== COMMON COMPONENTS ===== */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            margin-bottom: var(--space-lg);
        }
        
        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--dark);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .card-title i {
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: var(--space-md);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 600;
            color: var(--dark);
            font-size: var(--font-size-sm);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
            transition: all var(--transition-fast);
            background: white;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            text-decoration: none;
        }
        
        .btn i {
            font-size: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-dark);
            color: var(--dark);
        }
        
        .btn-outline:hover {
            background: var(--light);
            border-color: var(--primary);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: var(--font-size-xs);
        }
        
        .btn-icon {
            padding: 8px;
            border-radius: var(--radius-sm);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .btn-icon:hover {
            background: var(--light);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: var(--font-size-xs);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-primary {
            background: #dbeafe;
            color: var(--primary-dark);
        }
        
        .badge-success {
            background: #dcfce7;
            color: var(--success-dark);
        }
        
        .badge-warning {
            background: #fef3c7;
            color: var(--warning-dark);
        }
        
        .badge-danger {
            background: #fee2e2;
            color: var(--danger-dark);
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .alert {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .alert-success {
            background: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
        }
        
        .alert-warning {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            color: #92400e;
        }
        
        .alert-danger {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
        }
        
        .alert-info {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            color: #1e40af;
        }
        
        .alert-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .alert-content {
            flex: 1;
        }
        
        /* ===== TABLES ===== */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            margin-bottom: var(--space-lg);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .table th {
            background: var(--light);
            padding: 12px 16px;
            text-align: left;
            font-weight: 700;
            font-size: var(--font-size-sm);
            color: var(--dark);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }
        
        .table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            font-size: var(--font-size-sm);
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        .table tr:hover {
            background: #f8fafc;
        }
        
        .table-actions {
            display: flex;
            gap: var(--space-xs);
        }
        
        /* ===== ORDER MANAGEMENT ===== */
        .order-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .order-items-container {
            background: white;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            overflow: hidden;
        }
        
        .order-item {
            display: grid;
            grid-template-columns: 1fr 1fr 100px 60px;
            gap: var(--space-md);
            padding: var(--space-md);
            border-bottom: 1px solid var(--border);
            align-items: center;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-summary {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--light);
            border-radius: var(--radius-md);
            margin-top: var(--space-lg);
        }
        
        .summary-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-md);
            background: white;
            border-radius: var(--radius-md);
            min-width: 120px;
            box-shadow: var(--shadow-sm);
        }
        
        .summary-value {
            font-size: var(--font-size-2xl);
            font-weight: 800;
            color: var(--primary);
        }
        
        .summary-label {
            font-size: var(--font-size-xs);
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
        }
        
        /* ===== PRODUCTION VIEW ===== */
        .production-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .production-tile {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            transition: all var(--transition-fast);
        }
        
        .production-tile:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .production-value {
            font-size: var(--font-size-2xl);
            font-weight: 800;
            color: var(--dark);
            margin: var(--space-sm) 0;
        }
        
        .production-label {
            font-size: var(--font-size-sm);
            color: var(--muted);
            font-weight: 600;
        }
        
        /* ===== RECIPE VIEW ===== */
        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .ingredient-card {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }
        
        .ingredient-name {
            font-size: var(--font-size-md);
            font-weight: 700;
            color: var(--dark);
            margin-bottom: var(--space-sm);
        }
        
        .ingredient-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
        }
        
        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
        }
        
        .nutrition-item {
            padding: var(--space-xs) var(--space-sm);
            background: var(--light);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
        }
        
        .nutrition-label {
            color: var(--muted);
            font-weight: 600;
        }
        
        .nutrition-value {
            color: var(--dark);
            font-weight: 700;
        }
        
        /* ===== PRINT STYLES ===== */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .card {
                box-shadow: none !important;
                border: 1px solid #ccc !important;
                page-break-inside: avoid;
            }
        }
        
        /* ===== UTILITIES ===== */
        .d-flex { display: flex; }
        .d-none { display: none; }
        .flex-column { flex-direction: column; }
        .align-items-center { align-items: center; }
        .justify-content-between { justify-content: space-between; }
        .gap-1 { gap: var(--space-xs); }
        .gap-2 { gap: var(--space-sm); }
        .gap-3 { gap: var(--space-md); }
        .gap-4 { gap: var(--space-lg); }
        .mt-1 { margin-top: var(--space-xs); }
        .mt-2 { margin-top: var(--space-sm); }
        .mt-3 { margin-top: var(--space-md); }
        .mt-4 { margin-top: var(--space-lg); }
        .mb-1 { margin-bottom: var(--space-xs); }
        .mb-2 { margin-bottom: var(--space-sm); }
        .mb-3 { margin-bottom: var(--space-md); }
        .mb-4 { margin-bottom: var(--space-lg); }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-muted { color: var(--muted); }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }
        .text-primary { color: var(--primary); }
        .fw-bold { font-weight: 700; }
        .fw-bolder { font-weight: 800; }
        .fs-sm { font-size: var(--font-size-sm); }
        .fs-md { font-size: var(--font-size-md); }
        .fs-lg { font-size: var(--font-size-lg); }
        .w-100 { width: 100%; }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .app-container {
                border-radius: 0;
            }
            
            .app-header {
                flex-direction: column;
                gap: var(--space-md);
                padding: var(--space-md);
            }
            
            .main-nav {
                width: 100%;
                overflow-x: auto;
                padding: var(--space-sm);
            }
            
            .nav-btn {
                font-size: var(--font-size-xs);
                padding: 8px 12px;
            }
            
            .main-content {
                padding: var(--space-md);
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .production-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .order-form-grid {
                grid-template-columns: 1fr;
            }
            
            .order-item {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }
        }
        
        @media (max-width: 480px) {
            .production-stats {
                grid-template-columns: 1fr;
            }
            
            .ingredients-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-item {
                min-width: 100px;
            }
        }
        
        /* ===== PRODUCTION STATUS STYLES ===== */
        .status-0 { background: #fef3c7; color: #92400e; }
        .status-1 { background: #d1fae5; color: #065f46; }
        .status-2 { background: #fee2e2; color: #991b1b; }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        
        .status-dot-0 { background: #f59e0b; }
        .status-dot-1 { background: #10b981; }
        .status-dot-2 { background: #ef4444; }
    </style>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- HEADER -->
        <header class="app-header no-print">
            <div class="logo">
                <div class="logo-icon">üç®</div>
                <div>
                    <div class="logo-text">Sanremo Eisproduktion</div>
                    <div class="logo-subtitle">Komplettes Produktionsmanagement</div>
                </div>
            </div>
            
            <nav class="main-nav">
                <button class="nav-btn active" data-view="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" data-view="orders">
                    <i class="fas fa-shopping-cart"></i> Bestellungen
                </button>
                <button class="nav-btn" data-view="production">
                    <i class="fas fa-industry"></i> Produktion
                </button>
                <button class="nav-btn" data-view="recipes">
                    <i class="fas fa-book"></i> Rezepte
                </button>
                <button class="nav-btn" data-view="flavors">
                    <i class="fas fa-ice-cream"></i> Sorten
                </button>
                <button class="nav-btn" data-view="labels">
                    <i class="fas fa-tag"></i> Etiketten
                </button>
                <button class="nav-btn" data-view="customers">
                    <i class="fas fa-users"></i> Kunden
                </button>
                <button class="nav-btn" data-view="statistics">
                    <i class="fas fa-chart-bar"></i> Statistik
                </button>
                <button class="nav-btn" data-view="settings">
                    <i class="fas fa-cog"></i> Einstellungen
                </button>
            </nav>
        </header>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- DASHBOARD VIEW -->
            <section id="dashboard-view" class="view-container active">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-icon order">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-value" id="stat-today-orders">0</div>
                            <div class="stat-label">Heutige Bestellungen</div>
                            <div class="stat-change positive">+12%</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon production">
                                <i class="fas fa-industry"></i>
                            </div>
                            <div class="stat-value" id="stat-production-today">0 kg</div>
                            <div class="stat-label">Heutige Produktion</div>
                            <div class="stat-change positive">+8%</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon recipe">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-value" id="stat-recipes">0</div>
                            <div class="stat-label">Aktive Rezepte</div>
                            <div class="stat-change negative">-2%</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon label">
                                <i class="fas fa-tag"></i>
                            </div>
                            <div class="stat-value" id="stat-labels-today">0</div>
                            <div class="stat-label">Etiketten heute</div>
                            <div class="stat-change positive">+15%</div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <div class="alert-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="alert-content">
                            <strong>Willkommen!</strong> Heute haben Sie 3 offene Bestellungen und 45kg Produktion geplant.
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-calendar-alt"></i> Heutige Aktivit√§ten
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Zeit</th>
                                    <th>Aktivit√§t</th>
                                    <th>Status</th>
                                    <th>Aktion</th>
                                </tr>
                            </thead>
                            <tbody id="today-activities">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ORDERS VIEW -->
            <section id="orders-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-shopping-cart"></i> Bestellverwaltung
                    </div>
                    
                    <div class="order-form-grid">
                        <div class="form-group">
                            <label class="form-label">Kunde</label>
                            <select class="form-select" id="order-customer">
                                <option value="">Kunde ausw√§hlen...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Lieferdatum</label>
                            <input type="date" class="form-input" id="order-date">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Priorit√§t</label>
                            <select class="form-select" id="order-priority">
                                <option value="normal">Normal</option>
                                <option value="high">Hoch</option>
                                <option value="urgent">Dringend</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notizen</label>
                        <textarea class="form-textarea" id="order-notes" placeholder="Besondere Anweisungen..."></textarea>
                    </div>
                    
                    <div class="d-flex gap-3 mb-4">
                        <button class="btn btn-primary" id="add-order-item">
                            <i class="fas fa-plus"></i> Position hinzuf√ºgen
                        </button>
                        <button class="btn btn-outline" id="clear-order">
                            <i class="fas fa-trash"></i> Leeren
                        </button>
                    </div>
                    
                    <div class="order-items-container mb-3">
                        <div class="order-item fw-bold" style="background: var(--light);">
                            <div>Sorte</div>
                            <div>Gr√∂√üe</div>
                            <div>Menge</div>
                            <div>Aktion</div>
                        </div>
                        <div id="order-items-list">
                            <!-- Order items will be added here -->
                        </div>
                    </div>
                    
                    <div class="order-summary">
                        <div class="summary-item">
                            <div class="summary-value" id="total-items">0</div>
                            <div class="summary-label">Positionen</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="total-750g">0</div>
                            <div class="summary-label">750g</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="total-170g">0</div>
                            <div class="summary-label">170g</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="total-kg">0.0</div>
                            <div class="summary-label">KG</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="total-buckets">0</div>
                            <div class="summary-label">Eimer</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="total-euros">0.00</div>
                            <div class="summary-label">‚Ç¨ Gesamt</div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-3 mt-4">
                        <button class="btn btn-success" id="save-order">
                            <i class="fas fa-save"></i> Bestellung speichern
                        </button>
                        <button class="btn btn-primary" id="print-order">
                            <i class="fas fa-print"></i> Drucken
                        </button>
                        <button class="btn btn-warning" id="export-order">
                            <i class="fas fa-file-export"></i> Exportieren
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-history"></i> Letzte Bestellungen
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Kunde</th>
                                    <th>Menge</th>
                                    <th>Umsatz</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="recent-orders">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- PRODUCTION VIEW -->
            <section id="production-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-industry"></i> Produktionsplanung
                    </div>
                    
                    <div class="production-stats">
                        <div class="production-tile">
                            <div class="production-label">Heutige Produktion</div>
                            <div class="production-value" id="prod-today-kg">0 kg</div>
                            <div class="badge badge-success">Geplant</div>
                        </div>
                        
                        <div class="production-tile">
                            <div class="production-label">Eimer ben√∂tigt</div>
                            <div class="production-value" id="prod-buckets-needed">0</div>
                            <div class="badge badge-primary">6kg/Eimer</div>
                        </div>
                        
                        <div class="production-tile">
                            <div class="production-label">Fertiggestellt</div>
                            <div class="production-value" id="prod-completed">0%</div>
                            <div class="badge badge-success">Fortschritt</div>
                        </div>
                        
                        <div class="production-tile">
                            <div class="production-label">Offene Bestellungen</div>
                            <div class="production-value" id="prod-open-orders">0</div>
                            <div class="badge badge-warning">Zu bearbeiten</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Datum f√ºr Produktionsplan</label>
                        <input type="date" class="form-input" id="production-date" value="">
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Sorte</th>
                                    <th>750g</th>
                                    <th>170g</th>
                                    <th>KG</th>
                                    <th>Eimer</th>
                                    <th>Status</th>
                                    <th>Produziert</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="production-plan">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="d-flex gap-3">
                        <button class="btn btn-primary" id="generate-production-plan">
                            <i class="fas fa-calculator"></i> Plan generieren
                        </button>
                        <button class="btn btn-success" id="start-production">
                            <i class="fas fa-play"></i> Produktion starten
                        </button>
                        <button class="btn btn-primary" id="print-production-plan">
                            <i class="fas fa-print"></i> Plan drucken
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i> Produktionsfortschritt
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Sorte</th>
                                    <th>Geplant (KG)</th>
                                    <th>Produziert (KG)</th>
                                    <th>Rest (KG)</th>
                                    <th>Fortschritt</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="production-progress">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- RECIPES VIEW -->
            <section id="recipes-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-book"></i> Rezeptverwaltung
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Sorte ausw√§hlen oder neue erstellen</label>
                        <div class="d-flex gap-3">
                            <select class="form-select" id="recipe-flavor">
                                <option value="">Sorte ausw√§hlen...</option>
                            </select>
                            <button class="btn btn-primary" id="new-recipe">
                                <i class="fas fa-plus"></i> Neue Sorte
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group" id="recipe-form" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Name der Sorte</label>
                            <input type="text" class="form-input" id="recipe-name" placeholder="z.B. Vanille, Schokolade...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Produkttyp</label>
                            <select class="form-select" id="recipe-type">
                                <option value="milcheis">Milcheis</option>
                                <option value="sorbet">Sorbet</option>
                                <option value="fruchteis">Fruchteis</option>
                                <option value="speiseeis">Speiseeis</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Beschreibung</label>
                            <textarea class="form-textarea" id="recipe-description" placeholder="Kurze Beschreibung der Sorte..."></textarea>
                        </div>
                        
                        <div class="card-title mt-4">
                            <i class="fas fa-list"></i> Zutaten
                        </div>
                        
                        <div id="ingredients-list">
                            <!-- Ingredients will be added here -->
                        </div>
                        
                        <button class="btn btn-outline w-100 mt-3" id="add-ingredient">
                            <i class="fas fa-plus"></i> Zutat hinzuf√ºgen
                        </button>
                        
                        <div class="card-title mt-4">
                            <i class="fas fa-chart-pie"></i> N√§hrwertberechnung
                        </div>
                        
                        <div class="nutrition-grid" id="nutrition-values">
                            <!-- Nutrition values will be calculated -->
                        </div>
                        
                        <div class="d-flex gap-3 mt-4">
                            <button class="btn btn-success" id="save-recipe">
                                <i class="fas fa-save"></i> Rezept speichern
                            </button>
                            <button class="btn btn-outline" id="cancel-recipe">
                                <i class="fas fa-times"></i> Abbrechen
                            </button>
                        </div>
                    </div>
                    
                    <div class="card" id="recipe-list-card">
                        <div class="card-title">
                            <i class="fas fa-list-ul"></i> Alle Rezepte
                        </div>
                        <div class="ingredients-grid" id="recipes-list">
                            <!-- Recipe cards will be added here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- FLAVORS VIEW -->
            <section id="flavors-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-ice-cream"></i> Sortenverwaltung
                    </div>
                    
                    <div class="order-form-grid">
                        <div class="form-group">
                            <label class="form-label">Neue Sorte</label>
                            <input type="text" class="form-input" id="new-flavor-name" 
                                   placeholder="z.B. Haselnuss, Zitrone, Toffifee...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Kategorie</label>
                            <select class="form-select" id="new-flavor-category">
                                <option value="milcheis">Milcheis</option>
                                <option value="sorbet">Sorbet</option>
                                <option value="fruchteis">Fruchteis</option>
                                <option value="speiseeis">Speiseeis</option>
                                <option value="spezial">Spezial</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Beschreibung (optional)</label>
                        <textarea class="form-textarea" id="new-flavor-description" 
                                  placeholder="Kurze Beschreibung der Sorte..."></textarea>
                    </div>
                    
                    <div class="d-flex gap-3 mb-4">
                        <button class="btn btn-success" id="add-flavor-btn">
                            <i class="fas fa-plus"></i> Sorte hinzuf√ºgen
                        </button>
                        <button class="btn btn-outline" id="reset-flavors-btn">
                            <i class="fas fa-undo"></i> Standard-Sorten
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Sorte</th>
                                    <th>Kategorie</th>
                                    <th>Beschreibung</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="flavors-list">
                                <!-- Sabores ser√£o carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-info-circle"></i> Informationen
                    </div>
                    <div class="alert alert-info">
                        <div class="alert-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="alert-content">
                            <strong>Tipp:</strong> Sorten werden automatisch in allen Modulen verf√ºgbar. 
                            Deaktivierte Sorten erscheinen nicht in den Auswahllisten.
                        </div>
                    </div>
                </div>
            </section>

            <!-- LABELS VIEW -->
            <section id="labels-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-tag"></i> Etiketten-Generator
                    </div>
                    
                    <div class="order-form-grid">
                        <div class="form-group">
                            <label class="form-label">Sorte</label>
                            <select class="form-select" id="label-flavor">
                                <option value="">Sorte ausw√§hlen...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Packungsgr√∂√üe</label>
                            <select class="form-select" id="label-size">
                                <option value="170">170 g</option>
                                <option value="500">500 g</option>
                                <option value="750">750 g</option>
                                <option value="1000">1000 g</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Chargen-Nummer</label>
                            <input type="text" class="form-input" id="label-batch" placeholder="z.B. 2024-03-15-001">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">MHD (Mindesthaltbarkeitsdatum)</label>
                            <input type="date" class="form-input" id="label-expiry">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Besondere Hinweise</label>
                        <textarea class="form-textarea" id="label-notes" placeholder="Besondere Lagerhinweise oder Allergene..."></textarea>
                    </div>
                    
                    <div class="alert alert-warning" id="label-warnings" style="display: none;">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content" id="warning-content">
                            <!-- Warnings will appear here -->
                        </div>
                    </div>
                    
                    <div class="card mt-4" id="label-preview-card">
                        <div class="card-title">
                            <i class="fas fa-eye"></i> Etikett-Vorschau
                        </div>
                        <div class="label-preview" id="label-preview">
                            <!-- Label preview will be generated here -->
                        </div>
                    </div>
                    
                    <div class="d-flex gap-3 mt-4">
                        <button class="btn btn-primary" id="generate-label">
                            <i class="fas fa-sync"></i> Vorschau aktualisieren
                        </button>
                        <button class="btn btn-primary" id="print-label">
                            <i class="fas fa-print"></i> Etikett drucken
                        </button>
                        <button class="btn btn-warning" id="print-batch">
                            <i class="fas fa-print"></i> Charge drucken (10x)
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-history"></i> Zuletzt gedruckte Etiketten
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Sorte</th>
                                    <th>Gr√∂√üe</th>
                                    <th>Charge</th>
                                    <th>Menge</th>
                                    <th>Aktion</div>
                                </tr>
                            </thead>
                            <tbody id="recent-labels">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- CUSTOMERS VIEW -->
            <section id="customers-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-users"></i> Kundenverwaltung
                    </div>
                    
                    <div class="order-form-grid">
                        <div class="form-group">
                            <label class="form-label">Kundenname</label>
                            <input type="text" class="form-input" id="customer-name" placeholder="z.B. REWE, EDEKA...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Filiale / Standort</label>
                            <input type="text" class="form-input" id="customer-location" placeholder="z.B. Bad Berleburg, Hauptstra√üe 1">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Kontaktperson</label>
                            <input type="text" class="form-input" id="customer-contact" placeholder="Name der Kontaktperson">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Telefon</label>
                            <input type="tel" class="form-input" id="customer-phone" placeholder="Telefonnummer">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">E-Mail</label>
                            <input type="email" class="form-input" id="customer-email" placeholder="E-Mail-Adresse">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Kundentyp</label>
                            <select class="form-select" id="customer-type">
                                <option value="supermarkt">Supermarkt</option>
                                <option value="restaurant">Restaurant</option>
                                <option value="cafe">Caf√©</option>
                                <option value="grosshandel">Gro√ühandel</option>
                                <option value="privat">Privatkunde</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notizen</label>
                        <textarea class="form-textarea" id="customer-notes" placeholder="Besondere Vereinbarungen, Lieferzeiten..."></textarea>
                    </div>
                    
                    <div class="d-flex gap-3">
                        <button class="btn btn-success" id="save-customer">
                            <i class="fas fa-save"></i> Kunden speichern
                        </button>
                        <button class="btn btn-outline" id="clear-customer-form">
                            <i class="fas fa-times"></i> Formular leeren
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-address-book"></i> Kundenliste
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Standort</th>
                                    <th>Kontakt</th>
                                    <th>Typ</th>
                                    <th>Letzte Bestellung</th>
                                    <th>Gesamtumsatz</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="customers-list">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- STATISTICS VIEW -->
            <section id="statistics-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-chart-bar"></i> Statistik & Berichte
                    </div>
                    
                    <div class="order-form-grid">
                        <div class="form-group">
                            <label class="form-label">Zeitraum</label>
                            <select class="form-select" id="stat-period">
                                <option value="today">Heute</option>
                                <option value="week">Diese Woche</option>
                                <option value="month" selected>Dieser Monat</option>
                                <option value="quarter">Dieses Quartal</option>
                                <option value="year">Dieses Jahr</option>
                                <option value="custom">Benutzerdefiniert</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="custom-date-range" style="display: none;">
                            <div class="d-flex gap-3">
                                <div style="flex: 1;">
                                    <label class="form-label">Von</label>
                                    <input type="date" class="form-input" id="stat-from">
                                </div>
                                <div style="flex: 1;">
                                    <label class="form-label">Bis</label>
                                    <input type="date" class="form-input" id="stat-to">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Berichtstyp</label>
                            <select class="form-select" id="stat-type">
                                <option value="sales">Verk√§ufe</option>
                                <option value="production">Produktion</option>
                                <option value="customers">Kunden</option>
                                <option value="recipes">Rezepte</option>
                                <option value="inventory">Bestand</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-3 mb-4">
                        <button class="btn btn-primary" id="generate-report">
                            <i class="fas fa-chart-line"></i> Bericht generieren
                        </button>
                        <button class="btn btn-primary" id="print-report">
                            <i class="fas fa-print"></i> Bericht drucken
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Metrik</th>
                                    <th>Wert</th>
                                    <th>√Ñnderung</th>
                                    <th>Trend</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="statistics-data">
                                <!-- Statistics will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-title">
                            <i class="fas fa-chart-pie"></i> Umsatz nach Sorte
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Sorte</th>
                                        <th>170g</th>
                                        <th>750g</th>
                                        <th>Umsatz (‚Ç¨)</th>
                                        <th>Anteil</th>
                                        <th>Trend</th>
                                    </tr>
                                </thead>
                                <tbody id="flavor-stats">
                                    <!-- Flavor statistics will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-title">
                            <i class="fas fa-euro-sign"></i> Preiseinstellungen
                        </div>
                        <div class="order-form-grid">
                            <div class="form-group">
                                <label class="form-label">Preis 170g (‚Ç¨)</label>
                                <input type="number" class="form-input" id="price-small" value="2.26" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Preis 750g (‚Ç¨)</label>
                                <input type="number" class="form-input" id="price-large" value="5.90" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="d-flex gap-3">
                            <button class="btn btn-success" id="save-prices">
                                <i class="fas fa-save"></i> Preise speichern
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SETTINGS VIEW -->
            <section id="settings-view" class="view-container">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-cog"></i> Systemeinstellungen
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Unternehmensname</label>
                        <input type="text" class="form-input" id="company-name" value="Eiscaf√© Sanremo">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Adresse</label>
                        <textarea class="form-textarea" id="company-address" rows="2">Bad Berleburg</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Telefon</label>
                        <input type="tel" class="form-input" id="company-phone" value="0176 72809926">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Standard-Eisgr√∂√üen</label>
                        <div class="d-flex gap-3">
                            <input type="number" class="form-input" id="size-170" value="170" min="1" placeholder="170">
                            <input type="number" class="form-input" id="size-500" value="500" min="1" placeholder="500">
                            <input type="number" class="form-input" id="size-750" value="750" min="1" placeholder="750">
                            <input type="number" class="form-input" id="size-1000" value="1000" min="1" placeholder="1000">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Eimer-Gr√∂√üe (kg)</label>
                        <input type="number" class="form-input" id="bucket-size" value="6" min="1" step="0.5">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Standard-MHD (Tage)</label>
                        <input type="number" class="form-input" id="default-expiry" value="180" min="1">
                    </div>
                    
                    <div class="card-title mt-4">
                        <i class="fas fa-database"></i> Datenverwaltung
                    </div>
                    
                    <div class="d-flex gap-3">
                        <button class="btn btn-outline" id="backup-data">
                            <i class="fas fa-download"></i> Backup erstellen
                        </button>
                        <button class="btn btn-outline" id="restore-data">
                            <i class="fas fa-upload"></i> Backup wiederherstellen
                        </button>
                        <button class="btn btn-danger" id="reset-data">
                            <i class="fas fa-trash"></i> Daten zur√ºcksetzen
                        </button>
                    </div>
                    
                    <div class="alert alert-warning mt-4">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content">
                            <strong>Warnung:</strong> Das Zur√ºcksetzen der Daten kann nicht r√ºckg√§ngig gemacht werden. Erstellen Sie vorher ein Backup.
                        </div>
                    </div>
                    
                    <div class="card-title mt-4">
                        <i class="fas fa-paint-brush"></i> Darstellung
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Design</label>
                        <select class="form-select" id="theme-select">
                            <option value="light">Hell</option>
                            <option value="dark">Dunkel</option>
                            <option value="auto">Automatisch</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Sprache</label>
                        <select class="form-select" id="language-select">
                            <option value="de" selected>Deutsch</option>
                            <option value="en">English</option>
                            <option value="pt">Portugu√™s</option>
                        </select>
                    </div>
                    
                    <div class="d-flex gap-3 mt-4">
                        <button class="btn btn-success" id="save-settings">
                            <i class="fas fa-save"></i> Einstellungen speichern
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- FOOTER -->
        <footer class="app-footer no-print" style="padding: var(--space-md); background: var(--light); border-top: 1px solid var(--border); text-align: center; color: var(--muted); font-size: var(--font-size-sm);">
            <div class="d-flex justify-content-between align-items-center">
                <div>¬© 2024 Eiscaf√© Sanremo - Alle Rechte vorbehalten</div>
                <div>
                    <span id="current-time">--:--</span> | 
                    <span id="data-status" class="badge badge-success">Daten gespeichert</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- MODALS -->
    <div id="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div id="modal-content" style="background: white; border-radius: var(--radius-lg); padding: var(--space-xl); max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <!-- Modal content will be injected here -->
        </div>
    </div>

    <script>
        // ===== DATABASE MANAGEMENT =====
        const DB = {
            VERSION: '1.1.0', // Updated version for new features
            KEYS: {
                ORDERS: 'sanremo_orders',
                CUSTOMERS: 'sanremo_customers',
                RECIPES: 'sanremo_recipes',
                FLAVORS: 'sanremo_flavors',
                INGREDIENTS: 'sanremo_ingredients',
                PRODUCTION: 'sanremo_production',
                PRODUCTION_HISTORY: 'sanremo_production_history',
                SETTINGS: 'sanremo_settings',
                STATISTICS: 'sanremo_statistics',
                PRICES: 'sanremo_prices'
            },
            
            // Initialize all data
            init() {
                // Initialize empty databases if they don't exist
                if (!localStorage.getItem(this.KEYS.ORDERS)) {
                    localStorage.setItem(this.KEYS.ORDERS, JSON.stringify([]));
                }
                if (!localStorage.getItem(this.KEYS.CUSTOMERS)) {
                    localStorage.setItem(this.KEYS.CUSTOMERS, JSON.stringify([
                        {
                            id: '1',
                            name: 'REWE',
                            location: 'Bad Berleburg',
                            contact: 'Herr Schmidt',
                            phone: '02751 12345',
                            email: 'rewe@example.com',
                            type: 'supermarkt',
                            notes: 'Lieferung bis 09:00 Uhr',
                            created: new Date().toISOString()
                        },
                        {
                            id: '2',
                            name: 'EDEKA',
                            location: 'Bad Berleburg',
                            contact: 'Frau Meyer',
                            phone: '02751 67890',
                            email: 'edeka@example.com',
                            type: 'supermarkt',
                            notes: 'Hintereingang nutzen',
                            created: new Date().toISOString()
                        }
                    ]));
                }
                if (!localStorage.getItem(this.KEYS.RECIPES)) {
                    localStorage.setItem(this.KEYS.RECIPES, JSON.stringify([]));
                }
                if (!localStorage.getItem(this.KEYS.FLAVORS)) {
                    localStorage.setItem(this.KEYS.FLAVORS, JSON.stringify([
                        { id: '1', name: 'Stracciatella', category: 'milcheis', description: 'Milcheis mit Schokost√ºckchen', active: true },
                        { id: '2', name: 'Amarena Kirsch', category: 'sorbet', description: 'Sauerkirsch-Sorbet mit Amarena', active: true },
                        { id: '3', name: 'Vanille', category: 'milcheis', description: 'Klassische Vanille', active: true },
                        { id: '4', name: 'Spaghetti', category: 'speiseeis', description: 'Eis mit Spaghetti-Optik', active: true },
                        { id: '5', name: 'Toffifee', category: 'milcheis', description: 'Mit Toffifee-St√ºckchen', active: true },
                        { id: '6', name: 'Cookies', category: 'milcheis', description: 'Mit Cookie-St√ºckchen', active: true },
                        { id: '7', name: 'Wei√ü Schokolade Pistazien', category: 'milcheis', description: 'Wei√üe Schokolade mit Pistazien', active: true },
                        { id: '8', name: 'Erdbeer', category: 'fruchteis', description: 'Frisches Erdbeereis', active: true },
                        { id: '9', name: 'Joghurt Orange', category: 'fruchteis', description: 'Joghurt-Eis mit Orangen', active: true },
                        { id: '10', name: 'Kinder Buenos', category: 'milcheis', description: 'Mit Kinder Buenos', active: true },
                        { id: '11', name: 'Kinder Riegel', category: 'milcheis', description: 'Mit Kinder Riegel', active: true },
                        { id: '12', name: 'Joghurete Schokolade', category: 'milcheis', description: 'Joghurt-Eis mit Schokolade', active: true },
                        { id: '13', name: 'Mango', category: 'sorbet', description: 'Mango-Sorbet', active: true },
                        { id: '14', name: 'Hanutta', category: 'spezial', description: 'Spezialit√§t', active: true }
                    ]));
                }
                if (!localStorage.getItem(this.KEYS.INGREDIENTS)) {
                    localStorage.setItem(this.KEYS.INGREDIENTS, JSON.stringify([]));
                }
                if (!localStorage.getItem(this.KEYS.PRODUCTION)) {
                    localStorage.setItem(this.KEYS.PRODUCTION, JSON.stringify([]));
                }
                if (!localStorage.getItem(this.KEYS.PRODUCTION_HISTORY)) {
                    localStorage.setItem(this.KEYS.PRODUCTION_HISTORY, JSON.stringify([]));
                }
                if (!localStorage.getItem(this.KEYS.SETTINGS)) {
                    localStorage.setItem(this.KEYS.SETTINGS, JSON.stringify({
                        company_name: 'Eiscaf√© Sanremo',
                        company_address: 'Bad Berleburg',
                        company_phone: '0176 72809926',
                        sizes: [170, 500, 750, 1000],
                        bucket_size: 6,
                        default_expiry_days: 180,
                        theme: 'light',
                        language: 'de'
                    }));
                }
                if (!localStorage.getItem(this.KEYS.STATISTICS)) {
                    localStorage.setItem(this.KEYS.STATISTICS, JSON.stringify([]));
                }
                if (!localStorage.getItem(this.KEYS.PRICES)) {
                    localStorage.setItem(this.KEYS.PRICES, JSON.stringify({
                        small: 2.26,  // Pre√ßo para 170g
                        large: 5.90    // Pre√ßo para 750g
                    }));
                }
            },
            
            // Generic get method
            get(key) {
                try {
                    return JSON.parse(localStorage.getItem(key)) || [];
                } catch (e) {
                    console.error('Error reading from localStorage:', e);
                    return [];
                }
            },
            
            // Generic set method
            set(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error('Error writing to localStorage:', e);
                    return false;
                }
            },
            
            // Get all orders
            getOrders() {
                return this.get(this.KEYS.ORDERS);
            },
            
            // Save an order
            saveOrder(order) {
                const orders = this.getOrders();
                order.id = order.id || 'order_' + Date.now();
                order.created = order.created || new Date().toISOString();
                order.updated = new Date().toISOString();
                
                // Calculate total price
                const prices = this.getPrices();
                let totalPrice = 0;
                order.items?.forEach(item => {
                    const itemPrice = item.size === '170' ? prices.small : 
                                     item.size === '750' ? prices.large : 0;
                    totalPrice += itemPrice * item.quantity;
                });
                order.totalPrice = totalPrice;
                
                orders.push(order);
                return this.set(this.KEYS.ORDERS, orders);
            },
            
            // Get all customers
            getCustomers() {
                return this.get(this.KEYS.CUSTOMERS);
            },
            
            // Save a customer
            saveCustomer(customer) {
                const customers = this.getCustomers();
                customer.id = customer.id || 'customer_' + Date.now();
                customer.created = customer.created || new Date().toISOString();
                customer.updated = new Date().toISOString();
                customers.push(customer);
                return this.set(this.KEYS.CUSTOMERS, customers);
            },
            
            // Delete a customer
            deleteCustomer(id) {
                const customers = this.getCustomers();
                const filtered = customers.filter(c => c.id !== id);
                return this.set(this.KEYS.CUSTOMERS, filtered);
            },
            
            // Get all flavors
            getFlavors() {
                return this.get(this.KEYS.FLAVORS);
            },
            
            // Save flavors
            saveFlavors(flavors) {
                return this.set(this.KEYS.FLAVORS, flavors);
            },
            
            // Get all recipes
            getRecipes() {
                return this.get(this.KEYS.RECIPES);
            },
            
            // Save a recipe
            saveRecipe(recipe) {
                const recipes = this.getRecipes();
                recipe.id = recipe.id || 'recipe_' + Date.now();
                recipe.created = recipe.created || new Date().toISOString();
                recipe.updated = new Date().toISOString();
                recipes.push(recipe);
                return this.set(this.KEYS.RECIPES, recipes);
            },
            
            // Get settings
            getSettings() {
                return this.get(this.KEYS.SETTINGS);
            },
            
            // Save settings
            saveSettings(settings) {
                return this.set(this.KEYS.SETTINGS, settings);
            },
            
            // Get prices
            getPrices() {
                return this.get(this.KEYS.PRICES);
            },
            
            // Save prices
            savePrices(prices) {
                return this.set(this.KEYS.PRICES, prices);
            },
            
            // Get production
            getProduction() {
                return this.get(this.KEYS.PRODUCTION);
            },
            
            // Save production
            saveProduction(production) {
                return this.set(this.KEYS.PRODUCTION, production);
            },
            
            // Get production history
            getProductionHistory() {
                return this.get(this.KEYS.PRODUCTION_HISTORY);
            },
            
            // Save production history
            saveProductionHistory(history) {
                return this.set(this.KEYS.PRODUCTION_HISTORY, history);
            },
            
            // Add production history record
            addProductionHistory(record) {
                const history = this.getProductionHistory();
                record.id = 'prod_' + Date.now();
                record.timestamp = new Date().toISOString();
                history.push(record);
                return this.set(this.KEYS.PRODUCTION_HISTORY, history);
            },
            
            // Backup all data
            backup() {
                const backup = {
                    version: this.VERSION,
                    timestamp: new Date().toISOString(),
                    orders: this.getOrders(),
                    customers: this.getCustomers(),
                    recipes: this.getRecipes(),
                    flavors: this.getFlavors(),
                    ingredients: this.get(this.KEYS.INGREDIENTS),
                    production: this.getProduction(),
                    production_history: this.getProductionHistory(),
                    settings: this.getSettings(),
                    statistics: this.get(this.KEYS.STATISTICS),
                    prices: this.getPrices()
                };
                return JSON.stringify(backup, null, 2);
            },
            
            // Restore from backup
            restore(backupData) {
                try {
                    const backup = JSON.parse(backupData);
                    
                    // Validate backup structure
                    if (!backup.version || !backup.timestamp) {
                        throw new Error('Invalid backup format');
                    }
                    
                    // Restore each database
                    this.set(this.KEYS.ORDERS, backup.orders || []);
                    this.set(this.KEYS.CUSTOMERS, backup.customers || []);
                    this.set(this.KEYS.RECIPES, backup.recipes || []);
                    this.set(this.KEYS.FLAVORS, backup.flavors || []);
                    this.set(this.KEYS.INGREDIENTS, backup.ingredients || []);
                    this.set(this.KEYS.PRODUCTION, backup.production || []);
                    this.set(this.KEYS.PRODUCTION_HISTORY, backup.production_history || []);
                    this.set(this.KEYS.SETTINGS, backup.settings || {});
                    this.set(this.KEYS.STATISTICS, backup.statistics || []);
                    this.set(this.KEYS.PRICES, backup.prices || { small: 2.26, large: 5.90 });
                    
                    return true;
                } catch (e) {
                    console.error('Error restoring backup:', e);
                    return false;
                }
            }
        };

        // ===== UTILITY FUNCTIONS =====
        const Utils = {
            // Format date to German format
            formatDate(date, includeTime = false) {
                const d = new Date(date);
                const day = d.getDate().toString().padStart(2, '0');
                const month = (d.getMonth() + 1).toString().padStart(2, '0');
                const year = d.getFullYear();
                
                if (includeTime) {
                    const hours = d.getHours().toString().padStart(2, '0');
                    const minutes = d.getMinutes().toString().padStart(2, '0');
                    return `${day}.${month}.${year} ${hours}:${minutes}`;
                }
                
                return `${day}.${month}.${year}`;
            },
            
            // Calculate weight in kg
            calculateWeight(size, quantity) {
                const sizeMap = {
                    '170': 0.170,
                    '500': 0.500,
                    '750': 0.750,
                    '1000': 1.000
                };
                return (sizeMap[size] || 0) * quantity;
            },
            
            // Calculate number of buckets needed
            calculateBuckets(totalKg, bucketSize = 6) {
                return Math.ceil(totalKg / bucketSize);
            },
            
            // Calculate total price
            calculatePrice(items) {
                const prices = DB.getPrices();
                let total = 0;
                items?.forEach(item => {
                    const itemPrice = item.size === '170' ? prices.small : 
                                     item.size === '750' ? prices.large : 0;
                    total += itemPrice * item.quantity;
                });
                return total.toFixed(2);
            },
            
            // Show notification
            showNotification(message, type = 'info') {
                // Remove existing notifications
                const existing = document.querySelector('.notification');
                if (existing) existing.remove();
                
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `notification alert alert-${type}`;
                notification.innerHTML = `
                    <div class="alert-icon">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'danger' ? 'times-circle' : 'info-circle'}"></i>
                    </div>
                    <div class="alert-content">${message}</div>
                `;
                
                // Add to body
                document.body.appendChild(notification);
                
                // Position it
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.zIndex = '3000';
                notification.style.maxWidth = '400px';
                notification.style.boxShadow = 'var(--shadow-lg)';
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100px)';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            },
            
            // Show modal
            showModal(title, content, buttons = []) {
                const overlay = document.getElementById('modal-overlay');
                const modalContent = document.getElementById('modal-content');
                
                // Build modal HTML
                let html = `
                    <div class="card-title" style="margin-bottom: var(--space-lg);">
                        <i class="fas fa-info-circle"></i> ${title}
                    </div>
                    <div style="margin-bottom: var(--space-lg);">
                        ${content}
                    </div>
                `;
                
                // Add buttons if provided
                if (buttons.length > 0) {
                    html += '<div class="d-flex gap-3 justify-content-end">';
                    buttons.forEach(btn => {
                        html += `<button class="btn btn-${btn.type}" id="modal-btn-${btn.id}">${btn.label}</button>`;
                    });
                    html += '</div>';
                } else {
                    html += '<div class="text-center"><button class="btn btn-primary" id="modal-close">OK</button></div>';
                }
                
                modalContent.innerHTML = html;
                overlay.style.display = 'flex';
                
                // Add event listeners
                if (buttons.length > 0) {
                    buttons.forEach(btn => {
                        document.getElementById(`modal-btn-${btn.id}`).onclick = () => {
                            btn.onClick();
                            overlay.style.display = 'none';
                        };
                    });
                } else {
                    document.getElementById('modal-close').onclick = () => {
                        overlay.style.display = 'none';
                    };
                }
                
                // Close on overlay click
                overlay.onclick = (e) => {
                    if (e.target === overlay) {
                        overlay.style.display = 'none';
                    }
                };
            },
            
            // Generate unique ID
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            },
            
            // Get status text
            getStatusText(status) {
                const statuses = {
                    0: { text: 'Geplant', class: 'warning' },
                    1: { text: 'In Produktion', class: 'info' },
                    2: { text: 'Fertiggestellt', class: 'success' },
                    3: { text: 'Ausgeliefert', class: 'primary' }
                };
                return statuses[status] || statuses[0];
            }
        };

        // ===== APPLICATION STATE =====
        const AppState = {
            currentView: 'dashboard',
            currentOrder: {
                customerId: '',
                date: '',
                priority: 'normal',
                notes: '',
                items: []
            },
            currentRecipe: null,
            currentCustomer: null
        };

        // ===== VIEW MANAGER =====
        const ViewManager = {
            init() {
                // Set up navigation buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const view = btn.getAttribute('data-view');
                        this.switchView(view);
                    });
                });
                
                // Initialize all views
                this.switchView('dashboard');
            },
            
            switchView(viewName) {
                // Update active button
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('data-view') === viewName);
                });
                
                // Hide all views
                document.querySelectorAll('.view-container').forEach(view => {
                    view.classList.remove('active');
                });
                
                // Show selected view
                const targetView = document.getElementById(`${viewName}-view`);
                if (targetView) {
                    targetView.classList.add('active');
                    AppState.currentView = viewName;
                    
                    // Initialize view-specific content
                    this.initView(viewName);
                }
            },
            
            initView(viewName) {
                switch(viewName) {
                    case 'dashboard':
                        Dashboard.init();
                        break;
                    case 'orders':
                        Orders.init();
                        break;
                    case 'production':
                        Production.init();
                        break;
                    case 'recipes':
                        Recipes.init();
                        break;
                    case 'flavors':
                        Flavors.init();
                        break;
                    case 'labels':
                        Labels.init();
                        break;
                    case 'customers':
                        Customers.init();
                        break;
                    case 'statistics':
                        Statistics.init();
                        break;
                    case 'settings':
                        Settings.init();
                        break;
                }
            }
        };

        // ===== DASHBOARD MODULE =====
        const Dashboard = {
            init() {
                this.updateStatistics();
                this.loadTodayActivities();
                
                // Update time every minute
                setInterval(() => this.updateTime(), 60000);
                this.updateTime();
            },
            
            updateStatistics() {
                const orders = DB.getOrders();
                const today = new Date().toISOString().split('T')[0];
                
                // Today's orders
                const todayOrders = orders.filter(o => o.date === today);
                document.getElementById('stat-today-orders').textContent = todayOrders.length;
                
                // Today's production (calculate from orders)
                let todayProduction = 0;
                let todayRevenue = 0;
                todayOrders.forEach(order => {
                    todayRevenue += parseFloat(order.totalPrice) || 0;
                    order.items?.forEach(item => {
                        todayProduction += Utils.calculateWeight(item.size, item.quantity);
                    });
                });
                document.getElementById('stat-production-today').textContent = todayProduction.toFixed(1) + ' kg';
                
                // Recipe count
                const recipes = DB.getRecipes();
                document.getElementById('stat-recipes').textContent = recipes.length;
                
                // Labels printed today (placeholder)
                document.getElementById('stat-labels-today').textContent = todayOrders.length * 3; // Estimate
            },
            
            loadTodayActivities() {
                const activities = [
                    {
                        time: '08:00',
                        activity: 'Tagesproduktion starten',
                        status: 'In Bearbeitung',
                        action: 'Fortsetzen'
                    },
                    {
                        time: '09:30',
                        activity: 'Lieferung an REWE',
                        status: 'Erledigt',
                        action: 'Details'
                    },
                    {
                        time: '11:00',
                        activity: 'Neue Bestellung: EDEKA',
                        status: 'Ausstehend',
                        action: 'Bearbeiten'
                    },
                    {
                        time: '14:00',
                        activity: 'Qualit√§tskontrolle',
                        status: 'Geplant',
                        action: 'Planen'
                    }
                ];
                
                const tbody = document.getElementById('today-activities');
                tbody.innerHTML = '';
                
                activities.forEach(activity => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${activity.time}</td>
                        <td>${activity.activity}</td>
                        <td><span class="badge ${activity.status === 'Erledigt' ? 'badge-success' : activity.status === 'In Bearbeitung' ? 'badge-warning' : 'badge-primary'}">${activity.status}</span></td>
                        <td><button class="btn btn-sm btn-outline">${activity.action}</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            },
            
            updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('de-DE', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                document.getElementById('current-time').textContent = timeString;
            }
        };

        // ===== FLAVORS MODULE =====
        const Flavors = {
            init() {
                this.setupEventListeners();
                this.loadFlavors();
                this.updateAllFlavorSelects();
            },
            
            // Sabores padr√£o
            defaultFlavors: [
                { id: '1', name: 'Stracciatella', category: 'milcheis', description: 'Milcheis mit Schokost√ºckchen', active: true },
                { id: '2', name: 'Amarena Kirsch', category: 'sorbet', description: 'Sauerkirsch-Sorbet mit Amarena', active: true },
                { id: '3', name: 'Vanille', category: 'milcheis', description: 'Klassische Vanille', active: true },
                { id: '4', name: 'Spaghetti', category: 'speiseeis', description: 'Eis mit Spaghetti-Optik', active: true },
                { id: '5', name: 'Toffifee', category: 'milcheis', description: 'Mit Toffifee-St√ºckchen', active: true },
                { id: '6', name: 'Cookies', category: 'milcheis', description: 'Mit Cookie-St√ºckchen', active: true },
                { id: '7', name: 'Wei√ü Schokolade Pistazien', category: 'milcheis', description: 'Wei√üe Schokolade mit Pistazien', active: true },
                { id: '8', name: 'Erdbeer', category: 'fruchteis', description: 'Frisches Erdbeereis', active: true },
                { id: '9', name: 'Joghurt Orange', category: 'fruchteis', description: 'Joghurt-Eis mit Orangen', active: true },
                { id: '10', name: 'Kinder Buenos', category: 'milcheis', description: 'Mit Kinder Buenos', active: true },
                { id: '11', name: 'Kinder Riegel', category: 'milcheis', description: 'Mit Kinder Riegel', active: true },
                { id: '12', name: 'Joghurete Schokolade', category: 'milcheis', description: 'Joghurt-Eis mit Schokolade', active: true },
                { id: '13', name: 'Mango', category: 'sorbet', description: 'Mango-Sorbet', active: true },
                { id: '14', name: 'Hanutta', category: 'spezial', description: 'Spezialit√§t', active: true }
            ],
            
            setupEventListeners() {
                // Add flavor button
                document.getElementById('add-flavor-btn')?.addEventListener('click', () => {
                    this.handleAddFlavor();
                });
                
                // Reset flavors button
                document.getElementById('reset-flavors-btn')?.addEventListener('click', () => {
                    this.resetToDefaults();
                });
            },
            
            // Get all active flavors
            getActiveFlavors() {
                const flavors = DB.getFlavors();
                return flavors.filter(f => f.active !== false);
            },
            
            // Add new flavor
            handleAddFlavor() {
                const nameInput = document.getElementById('new-flavor-name');
                const categoryInput = document.getElementById('new-flavor-category');
                const descriptionInput = document.getElementById('new-flavor-description');
                
                const name = nameInput.value.trim();
                const category = categoryInput.value;
                const description = descriptionInput.value.trim();
                
                if (!name) {
                    Utils.showNotification('Bitte geben Sie einen Namen f√ºr die Sorte ein', 'warning');
                    return;
                }
                
                const flavorData = {
                    name: name.charAt(0).toUpperCase() + name.slice(1).toLowerCase(),
                    category,
                    description,
                    active: true
                };
                
                if (this.addFlavor(flavorData)) {
                    // Clear form
                    nameInput.value = '';
                    descriptionInput.value = '';
                    nameInput.focus();
                }
            },
            
            addFlavor(flavorData) {
                const flavors = DB.getFlavors();
                
                // Check if already exists
                const exists = flavors.some(f => 
                    f.name.toLowerCase() === flavorData.name.toLowerCase()
                );
                
                if (exists) {
                    Utils.showNotification('Diese Sorte existiert bereits', 'warning');
                    return false;
                }
                
                // Add ID and timestamp
                const newFlavor = {
                    id: Utils.generateId(),
                    ...flavorData,
                    created: new Date().toISOString()
                };
                
                flavors.push(newFlavor);
                
                if (DB.saveFlavors(flavors)) {
                    Utils.showNotification(`Sorte "${flavorData.name}" hinzugef√ºgt`, 'success');
                    this.loadFlavors();
                    this.updateAllFlavorSelects();
                    return true;
                }
                
                return false;
            },
            
            loadFlavors() {
                const flavors = DB.getFlavors();
                const tbody = document.getElementById('flavors-list');
                
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                flavors.forEach(flavor => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="flavor-color" style="width: 12px; height: 12px; border-radius: 50%; 
                                      background: ${this.getCategoryColor(flavor.category)};"></div>
                                <strong>${flavor.name}</strong>
                                ${!flavor.active ? '<span class="badge badge-danger">Inaktiv</span>' : ''}
                            </div>
                        </td>
                        <td>
                            <span class="badge ${this.getCategoryClass(flavor.category)}">
                                ${this.getCategoryName(flavor.category)}
                            </span>
                        </td>
                        <td class="text-muted fs-sm">${flavor.description || '‚Äî'}</td>
                        <td>
                            <span class="badge ${flavor.active ? 'badge-success' : 'badge-danger'}">
                                ${flavor.active ? 'Aktiv' : 'Inaktiv'}
                            </span>
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="btn-icon edit-flavor" data-id="${flavor.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon toggle-flavor" data-id="${flavor.id}" 
                                        data-active="${flavor.active}">
                                    <i class="fas ${flavor.active ? 'fa-eye-slash' : 'fa-eye'}"></i>
                                </button>
                                <button class="btn-icon delete-flavor" data-id="${flavor.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                // Add event listeners
                this.addFlavorEventListeners();
            },
            
            addFlavorEventListeners() {
                // Edit flavor
                document.querySelectorAll('.edit-flavor').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const flavorId = e.target.closest('button').getAttribute('data-id');
                        this.editFlavor(flavorId);
                    });
                });
                
                // Toggle flavor active status
                document.querySelectorAll('.toggle-flavor').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const flavorId = e.target.closest('button').getAttribute('data-id');
                        const currentActive = e.target.closest('button').getAttribute('data-active') === 'true';
                        this.toggleFlavorActive(flavorId, !currentActive);
                    });
                });
                
                // Delete flavor
                document.querySelectorAll('.delete-flavor').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const flavorId = e.target.closest('button').getAttribute('data-id');
                        this.deleteFlavor(flavorId);
                    });
                });
            },
            
            editFlavor(flavorId) {
                const flavors = DB.getFlavors();
                const flavor = flavors.find(f => f.id === flavorId);
                
                if (!flavor) return;
                
                // Create edit modal
                const content = `
                    <div class="form-group">
                        <label class="form-label">Name der Sorte</label>
                        <input type="text" class="form-input" id="edit-flavor-name" 
                               value="${flavor.name}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kategorie</label>
                        <select class="form-select" id="edit-flavor-category">
                            <option value="milcheis" ${flavor.category === 'milcheis' ? 'selected' : ''}>Milcheis</option>
                            <option value="sorbet" ${flavor.category === 'sorbet' ? 'selected' : ''}>Sorbet</option>
                            <option value="fruchteis" ${flavor.category === 'fruchteis' ? 'selected' : ''}>Fruchteis</option>
                            <option value="speiseeis" ${flavor.category === 'speiseeis' ? 'selected' : ''}>Speiseeis</option>
                            <option value="spezial" ${flavor.category === 'spezial' ? 'selected' : ''}>Spezial</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Beschreibung</label>
                        <textarea class="form-textarea" id="edit-flavor-description">${flavor.description || ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="edit-flavor-active">
                            <option value="true" ${flavor.active ? 'selected' : ''}>Aktiv</option>
                            <option value="false" ${!flavor.active ? 'selected' : ''}>Inaktiv</option>
                        </select>
                    </div>
                `;
                
                Utils.showModal('Sorte bearbeiten', content, [
                    {
                        id: 'cancel',
                        label: 'Abbrechen',
                        type: 'outline',
                        onClick: () => {}
                    },
                    {
                        id: 'save',
                        label: '√Ñnderungen speichern',
                        type: 'success',
                        onClick: () => {
                            const updatedName = document.getElementById('edit-flavor-name').value.trim();
                            const updatedCategory = document.getElementById('edit-flavor-category').value;
                            const updatedDescription = document.getElementById('edit-flavor-description').value.trim();
                            const updatedActive = document.getElementById('edit-flavor-active').value === 'true';
                            
                            if (!updatedName) {
                                Utils.showNotification('Name darf nicht leer sein', 'warning');
                                return;
                            }
                            
                            // Update flavor
                            flavor.name = updatedName;
                            flavor.category = updatedCategory;
                            flavor.description = updatedDescription;
                            flavor.active = updatedActive;
                            flavor.updated = new Date().toISOString();
                            
                            if (DB.saveFlavors(flavors)) {
                                Utils.showNotification('Sorte aktualisiert', 'success');
                                this.loadFlavors();
                                this.updateAllFlavorSelects();
                            }
                        }
                    }
                ]);
            },
            
            toggleFlavorActive(flavorId, active) {
                const flavors = DB.getFlavors();
                const flavor = flavors.find(f => f.id === flavorId);
                
                if (flavor) {
                    flavor.active = active;
                    flavor.updated = new Date().toISOString();
                    
                    if (DB.saveFlavors(flavors)) {
                        Utils.showNotification(
                            `Sorte ${active ? 'aktiviert' : 'deaktiviert'}`,
                            'success'
                        );
                        this.loadFlavors();
                        this.updateAllFlavorSelects();
                    }
                }
            },
            
            deleteFlavor(flavorId) {
                const flavors = DB.getFlavors();
                const flavor = flavors.find(f => f.id === flavorId);
                
                if (!flavor) return;
                
                Utils.showModal('Sorte l√∂schen',
                    `Sind Sie sicher, dass Sie die Sorte "${flavor.name}" l√∂schen m√∂chten?`,
                    [
                        {
                            id: 'cancel',
                            label: 'Abbrechen',
                            type: 'outline',
                            onClick: () => {}
                        },
                        {
                            id: 'delete',
                            label: 'L√∂schen',
                            type: 'danger',
                            onClick: () => {
                                const filtered = flavors.filter(f => f.id !== flavorId);
                                
                                if (DB.saveFlavors(filtered)) {
                                    Utils.showNotification('Sorte gel√∂scht', 'success');
                                    this.loadFlavors();
                                    this.updateAllFlavorSelects();
                                }
                            }
                        }
                    ]);
            },
            
            resetToDefaults() {
                Utils.showModal('Standard-Sorten wiederherstellen',
                    'M√∂chten Sie die Standard-Sorten wiederherstellen? Dies l√∂scht alle selbst erstellten Sorten.',
                    [
                        {
                            id: 'cancel',
                            label: 'Abbrechen',
                            type: 'outline',
                            onClick: () => {}
                        },
                        {
                            id: 'reset',
                            label: 'Wiederherstellen',
                            type: 'danger',
                            onClick: () => {
                                if (DB.saveFlavors(this.defaultFlavors)) {
                                    Utils.showNotification('Standard-Sorten wiederhergestellt', 'success');
                                    this.loadFlavors();
                                    this.updateAllFlavorSelects();
                                }
                            }
                        }
                    ]);
            },
            
            // Update all flavor selects in the system
            updateAllFlavorSelects() {
                const flavors = this.getActiveFlavors();
                
                // Update in orders module
                this.updateFlavorSelect('order-flavor', flavors);
                
                // Update in recipes module
                this.updateFlavorSelect('recipe-flavor', flavors);
                
                // Update in labels module
                this.updateFlavorSelect('label-flavor', flavors);
                
                // Update dynamic selects in order items
                document.querySelectorAll('.order-flavor-select').forEach(select => {
                    this.updateFlavorSelectElement(select, flavors);
                });
            },
            
            updateFlavorSelect(selectId, flavors) {
                const select = document.getElementById(selectId);
                if (select) {
                    this.updateFlavorSelectElement(select, flavors);
                }
            },
            
            updateFlavorSelectElement(selectElement, flavors) {
                const currentValue = selectElement.value;
                
                // Clear and rebuild
                selectElement.innerHTML = '<option value="">Sorte ausw√§hlen...</option>';
                
                // Group by category
                const grouped = {};
                flavors.forEach(flavor => {
                    if (!grouped[flavor.category]) {
                        grouped[flavor.category] = [];
                    }
                    grouped[flavor.category].push(flavor);
                });
                
                // Add by category
                Object.keys(grouped).forEach(category => {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = this.getCategoryName(category);
                    
                    grouped[category].forEach(flavor => {
                        const option = document.createElement('option');
                        option.value = flavor.name;
                        option.textContent = flavor.name;
                        optgroup.appendChild(option);
                    });
                    
                    selectElement.appendChild(optgroup);
                });
                
                // Restore selected value if still exists
                if (currentValue && Array.from(selectElement.options).some(opt => opt.value === currentValue)) {
                    selectElement.value = currentValue;
                }
            },
            
            getCategoryName(category) {
                const names = {
                    'milcheis': 'Milcheis',
                    'sorbet': 'Sorbet',
                    'fruchteis': 'Fruchteis',
                    'speiseeis': 'Speiseeis',
                    'spezial': 'Spezial'
                };
                return names[category] || 'Unbekannt';
            },
            
            getCategoryClass(category) {
                const classes = {
                    'milcheis': 'badge-primary',
                    'sorbet': 'badge-success',
                    'fruchteis': 'badge-warning',
                    'speiseeis': 'badge-danger',
                    'spezial': 'badge-info'
                };
                return classes[category] || 'badge-secondary';
            },
            
            getCategoryColor(category) {
                const colors = {
                    'milcheis': '#3b82f6',
                    'sorbet': '#10b981',
                    'fruchteis': '#f59e0b',
                    'speiseeis': '#ef4444',
                    'spezial': '#8b5cf6'
                };
                return colors[category] || '#6b7280';
            }
        };

        // ===== ORDERS MODULE =====
        const Orders = {
            init() {
                this.loadCustomers();
                this.setDefaultDate();
                this.setupEventListeners();
                this.loadRecentOrders();
            },
            
            loadCustomers() {
                const customers = DB.getCustomers();
                const select = document.getElementById('order-customer');
                select.innerHTML = '<option value="">Kunde ausw√§hlen...</option>';
                
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = `${customer.name} - ${customer.location}`;
                    select.appendChild(option);
                });
            },
            
            setDefaultDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('order-date').value = today;
            },
            
            setupEventListeners() {
                // Add order item
                document.getElementById('add-order-item').addEventListener('click', () => {
                    this.addOrderItem();
                });
                
                // Clear order
                document.getElementById('clear-order').addEventListener('click', () => {
                    AppState.currentOrder = {
                        customerId: '',
                        date: '',
                        priority: 'normal',
                        notes: '',
                        items: []
                    };
                    this.renderOrderItems();
                    this.updateOrderSummary();
                });
                
                // Save order
                document.getElementById('save-order').addEventListener('click', () => {
                    this.saveOrder();
                });
                
                // Print order
                document.getElementById('print-order').addEventListener('click', () => {
                    Printing.printOrder();
                });
                
                // Export order
                document.getElementById('export-order').addEventListener('click', () => {
                    this.exportOrder();
                });
            },
            
            addOrderItem() {
                const item = {
                    id: Utils.generateId(),
                    flavor: '',
                    size: '750',
                    quantity: 1
                };
                AppState.currentOrder.items.push(item);
                this.renderOrderItems();
            },
            
            renderOrderItems() {
                const container = document.getElementById('order-items-list');
                container.innerHTML = '';
                
                AppState.currentOrder.items.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'order-item';
                    div.innerHTML = `
                        <select class="form-select order-flavor" data-index="${index}">
                            <option value="">Sorte w√§hlen...</option>
                        </select>
                        <select class="form-select order-size" data-index="${index}">
                            <option value="170">170 g</option>
                            <option value="750" selected>750 g</option>
                            <option value="1000">1000 g</option>
                        </select>
                        <input type="number" class="form-input order-quantity" 
                               data-index="${index}" value="${item.quantity}" min="1" max="100">
                        <button class="btn btn-danger btn-sm remove-item" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    // Populate flavor options
                    const flavorSelect = div.querySelector('.order-flavor');
                    const flavors = Flavors.getActiveFlavors();
                    flavors.forEach(flavor => {
                        const option = document.createElement('option');
                        option.value = flavor.name;
                        option.textContent = flavor.name;
                        flavorSelect.appendChild(option);
                    });
                    
                    // Set selected values
                    flavorSelect.value = item.flavor;
                    div.querySelector('.order-size').value = item.size;
                    
                    container.appendChild(div);
                });
                
                // Add event listeners to new elements
                this.addItemEventListeners();
                this.updateOrderSummary();
            },
            
            addItemEventListeners() {
                // Flavor change
                document.querySelectorAll('.order-flavor').forEach(select => {
                    select.addEventListener('change', (e) => {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        AppState.currentOrder.items[index].flavor = e.target.value;
                        this.updateOrderSummary();
                    });
                });
                
                // Size change
                document.querySelectorAll('.order-size').forEach(select => {
                    select.addEventListener('change', (e) => {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        AppState.currentOrder.items[index].size = e.target.value;
                        this.updateOrderSummary();
                    });
                });
                
                // Quantity change
                document.querySelectorAll('.order-quantity').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        AppState.currentOrder.items[index].quantity = parseInt(e.target.value) || 1;
                        this.updateOrderSummary();
                    });
                });
                
                // Remove item
                document.querySelectorAll('.remove-item').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.closest('button').getAttribute('data-index'));
                        AppState.currentOrder.items.splice(index, 1);
                        this.renderOrderItems();
                    });
                });
            },
            
            updateOrderSummary() {
                let totalItems = 0;
                let total750g = 0;
                let total170g = 0;
                let totalKg = 0;
                
                AppState.currentOrder.items.forEach(item => {
                    totalItems += item.quantity;
                    if (item.size === '750') total750g += item.quantity;
                    if (item.size === '170') total170g += item.quantity;
                    totalKg += Utils.calculateWeight(item.size, item.quantity);
                });
                
                const bucketSize = DB.getSettings().bucket_size || 6;
                const totalBuckets = Utils.calculateBuckets(totalKg, bucketSize);
                const totalEuros = Utils.calculatePrice(AppState.currentOrder.items);
                
                document.getElementById('total-items').textContent = totalItems;
                document.getElementById('total-750g').textContent = total750g;
                document.getElementById('total-170g').textContent = total170g;
                document.getElementById('total-kg').textContent = totalKg.toFixed(1);
                document.getElementById('total-buckets').textContent = totalBuckets;
                document.getElementById('total-euros').textContent = totalEuros + ' ‚Ç¨';
            },
            
            saveOrder() {
                // Get form values
                const customerId = document.getElementById('order-customer').value;
                const date = document.getElementById('order-date').value;
                const priority = document.getElementById('order-priority').value;
                const notes = document.getElementById('order-notes').value;
                
                // Validate
                if (!customerId) {
                    Utils.showNotification('Bitte einen Kunden ausw√§hlen', 'warning');
                    return;
                }
                
                if (!date) {
                    Utils.showNotification('Bitte ein Lieferdatum ausw√§hlen', 'warning');
                    return;
                }
                
                if (AppState.currentOrder.items.length === 0) {
                    Utils.showNotification('Bitte mindestens eine Position hinzuf√ºgen', 'warning');
                    return;
                }
                
                // Create order object
                const order = {
                    customerId,
                    date,
                    priority,
                    notes,
                    items: [...AppState.currentOrder.items],
                    status: 'pending',
                    created: new Date().toISOString()
                };
                
                // Save to database
                if (DB.saveOrder(order)) {
                    Utils.showNotification('Bestellung erfolgreich gespeichert', 'success');
                    
                    // Reset form
                    AppState.currentOrder = {
                        customerId: '',
                        date: '',
                        priority: 'normal',
                        notes: '',
                        items: []
                    };
                    this.renderOrderItems();
                    this.updateOrderSummary();
                    document.getElementById('order-notes').value = '';
                    
                    // Reload recent orders
                    this.loadRecentOrders();
                    
                    // Update dashboard
                    Dashboard.updateStatistics();
                } else {
                    Utils.showNotification('Fehler beim Speichern der Bestellung', 'danger');
                }
            },
            
            loadRecentOrders() {
                const orders = DB.getOrders();
                const customers = DB.getCustomers();
                
                // Sort by date (newest first)
                orders.sort((a, b) => new Date(b.created) - new Date(a.created));
                
                const tbody = document.getElementById('recent-orders');
                tbody.innerHTML = '';
                
                // Show last 5 orders
                orders.slice(0, 5).forEach(order => {
                    const customer = customers.find(c => c.id === order.customerId);
                    const totalQuantity = order.items.reduce((sum, item) => sum + item.quantity, 0);
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${Utils.formatDate(order.date)}</td>
                        <td>${customer ? customer.name : 'Unbekannt'}</td>
                        <td>${totalQuantity} Stk.</td>
                        <td>${parseFloat(order.totalPrice || 0).toFixed(2)} ‚Ç¨</td>
                        <td>
                            <span class="badge ${order.status === 'completed' ? 'badge-success' : order.status === 'pending' ? 'badge-warning' : 'badge-primary'}">
                                ${order.status === 'completed' ? 'Erledigt' : order.status === 'pending' ? 'Ausstehend' : 'In Bearbeitung'}
                            </span>
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="btn-icon view-order" data-id="${order.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon edit-order" data-id="${order.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon delete-order" data-id="${order.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                // Add event listeners
                this.addOrderActionListeners();
            },
            
            addOrderActionListeners() {
                // View order
                document.querySelectorAll('.view-order').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.closest('button').getAttribute('data-id');
                        this.viewOrder(orderId);
                    });
                });
                
                // Edit order
                document.querySelectorAll('.edit-order').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.closest('button').getAttribute('data-id');
                        this.editOrder(orderId);
                    });
                });
                
                // Delete order
                document.querySelectorAll('.delete-order').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.closest('button').getAttribute('data-id');
                        this.deleteOrder(orderId);
                    });
                });
            },
            
            viewOrder(orderId) {
                const orders = DB.getOrders();
                const order = orders.find(o => o.id === orderId);
                
                if (order) {
                    let content = `
                        <h3>Bestelldetails</h3>
                        <p><strong>Datum:</strong> ${Utils.formatDate(order.date)}</p>
                        <p><strong>Status:</strong> ${order.status}</p>
                        <p><strong>Priorit√§t:</strong> ${order.priority}</p>
                        <p><strong>Gesamtpreis:</strong> ${parseFloat(order.totalPrice || 0).toFixed(2)} ‚Ç¨</p>
                        <p><strong>Notizen:</strong> ${order.notes || 'Keine'}</p>
                        <h4>Positionen:</h4>
                        <ul>
                    `;
                    
                    order.items.forEach(item => {
                        content += `<li>${item.quantity}x ${item.flavor} (${item.size}g)</li>`;
                    });
                    
                    content += '</ul>';
                    
                    Utils.showModal('Bestelldetails', content, [
                        {
                            id: 'close',
                            label: 'Schlie√üen',
                            type: 'primary',
                            onClick: () => {}
                        }
                    ]);
                }
            },
            
            editOrder(orderId) {
                Utils.showNotification('Bearbeitungsfunktion in Entwicklung', 'info');
            },
            
            deleteOrder(orderId) {
                Utils.showModal('Bestellung l√∂schen', 
                    'Sind Sie sicher, dass Sie diese Bestellung l√∂schen m√∂chten? Dieser Vorgang kann nicht r√ºckg√§ngig gemacht werden.',
                    [
                        {
                            id: 'cancel',
                            label: 'Abbrechen',
                            type: 'outline',
                            onClick: () => {}
                        },
                        {
                            id: 'delete',
                            label: 'L√∂schen',
                            type: 'danger',
                            onClick: () => {
                                const orders = DB.getOrders();
                                const filtered = orders.filter(o => o.id !== orderId);
                                DB.set(DB.KEYS.ORDERS, filtered);
                                this.loadRecentOrders();
                                Utils.showNotification('Bestellung gel√∂scht', 'success');
                            }
                        }
                    ]);
            },
            
            exportOrder() {
                Utils.showNotification('Exportfunktion in Entwicklung', 'info');
            }
        };

        // ===== PRODUCTION MODULE =====
        const Production = {
            init() {
                this.setDefaultDate();
                this.setupEventListeners();
                this.updateProductionStats();
            },
            
            setDefaultDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('production-date').value = today;
            },
            
            setupEventListeners() {
                // Generate production plan
                document.getElementById('generate-production-plan').addEventListener('click', () => {
                    this.generateProductionPlan();
                });
                
                // Start production
                document.getElementById('start-production').addEventListener('click', () => {
                    this.startProduction();
                });
                
                // Print production plan
                document.getElementById('print-production-plan').addEventListener('click', () => {
                    Printing.printProductionPlan();
                });
                
                // Date change
                document.getElementById('production-date').addEventListener('change', () => {
                    this.updateProductionStats();
                    this.loadProductionProgress();
                });
            },
            
            updateProductionStats() {
                const date = document.getElementById('production-date').value;
                const orders = DB.getOrders();
                
                // Filter orders for selected date
                const dateOrders = orders.filter(o => o.date === date);
                
                // Calculate totals
                let totalKg = 0;
                let total750g = 0;
                let total170g = 0;
                let openOrders = 0;
                
                dateOrders.forEach(order => {
                    if (order.status !== 'completed') openOrders++;
                    
                    order.items?.forEach(item => {
                        totalKg += Utils.calculateWeight(item.size, item.quantity);
                        if (item.size === '750') total750g += item.quantity;
                        if (item.size === '170') total170g += item.quantity;
                    });
                });
                
                const bucketSize = DB.getSettings().bucket_size || 6;
                const bucketsNeeded = Utils.calculateBuckets(totalKg, bucketSize);
                const completedPercent = dateOrders.length > 0 ? 
                    Math.round((dateOrders.filter(o => o.status === 'completed').length / dateOrders.length) * 100) : 0;
                
                // Update display
                document.getElementById('prod-today-kg').textContent = totalKg.toFixed(1) + ' kg';
                document.getElementById('prod-buckets-needed').textContent = bucketsNeeded;
                document.getElementById('prod-completed').textContent = completedPercent + '%';
                document.getElementById('prod-open-orders').textContent = openOrders;
            },
            
            generateProductionPlan() {
                const date = document.getElementById('production-date').value;
                const orders = DB.getOrders();
                const production = DB.getProduction();
                
                // Clear existing production for this date
                const filteredProduction = production.filter(p => p.date !== date);
                
                // Filter and aggregate by flavor
                const flavorMap = {};
                
                orders
                    .filter(o => o.date === date)
                    .forEach(order => {
                        order.items?.forEach(item => {
                            if (!flavorMap[item.flavor]) {
                                flavorMap[item.flavor] = {
                                    flavor: item.flavor,
                                    size750: 0,
                                    size170: 0,
                                    kg: 0,
                                    producedKg: 0,
                                    status: 0 // 0 = geplant, 1 = in produktion, 2 = fertiggestellt
                                };
                            }
                            
                            flavorMap[item.flavor].kg += Utils.calculateWeight(item.size, item.quantity);
                            if (item.size === '750') flavorMap[item.flavor].size750 += item.quantity;
                            if (item.size === '170') flavorMap[item.flavor].size170 += item.quantity;
                        });
                    });
                
                // Convert to array and sort by kg
                const flavors = Object.values(flavorMap)
                    .sort((a, b) => b.kg - a.kg);
                
                // Add to production database
                flavors.forEach(flavor => {
                    const productionItem = {
                        id: Utils.generateId(),
                        date: date,
                        flavor: flavor.flavor,
                        plannedKg: flavor.kg,
                        producedKg: 0,
                        size750: flavor.size750,
                        size170: flavor.size170,
                        status: 0,
                        created: new Date().toISOString()
                    };
                    filteredProduction.push(productionItem);
                });
                
                // Save to database
                DB.saveProduction(filteredProduction);
                
                // Render table
                this.renderProductionPlan();
                
                // Load production progress
                this.loadProductionProgress();
                
                Utils.showNotification('Produktionsplan generiert', 'success');
            },
            
            renderProductionPlan() {
                const date = document.getElementById('production-date').value;
                const production = DB.getProduction();
                const dateProduction = production.filter(p => p.date === date);
                
                // Render table
                const tbody = document.getElementById('production-plan');
                tbody.innerHTML = '';
                
                dateProduction.forEach(item => {
                    const bucketSize = DB.getSettings().bucket_size || 6;
                    const buckets = Utils.calculateBuckets(item.plannedKg, bucketSize);
                    const status = Utils.getStatusText(item.status);
                    const remainingKg = item.plannedKg - item.producedKg;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${item.flavor || 'Unbekannt'}</strong></td>
                        <td>${item.size750}</td>
                        <td>${item.size170}</td>
                        <td>${item.plannedKg.toFixed(2)} kg</td>
                        <td>${buckets} Eimer</td>
                        <td>
                            <span class="badge badge-${status.class}">
                                <span class="status-dot status-dot-${item.status}"></span>
                                ${status.text}
                            </span>
                        </td>
                        <td>${item.producedKg.toFixed(2)} kg</td>
                        <td>
                            <div class="table-actions">
                                ${item.status < 2 ? `
                                    <button class="btn-icon start-production" data-id="${item.id}">
                                        <i class="fas fa-play"></i>
                                    </button>
                                ` : ''}
                                ${item.status === 1 ? `
                                    <button class="btn-icon add-production" data-id="${item.id}">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                ` : ''}
                                ${item.status < 2 && item.producedKg > 0 ? `
                                    <button class="btn-icon remove-production" data-id="${item.id}">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                ` : ''}
                                <button class="btn-icon complete-production" data-id="${item.id}">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                // Add event listeners
                this.addProductionActionListeners();
            },
            
            addProductionActionListeners() {
                // Start production
                document.querySelectorAll('.start-production').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = e.target.closest('button').getAttribute('data-id');
                        this.startProductionItem(itemId);
                    });
                });
                
                // Add produced quantity
                document.querySelectorAll('.add-production').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = e.target.closest('button').getAttribute('data-id');
                        this.addProductionQuantity(itemId);
                    });
                });
                
                // Remove produced quantity
                document.querySelectorAll('.remove-production').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = e.target.closest('button').getAttribute('data-id');
                        this.removeProductionQuantity(itemId);
                    });
                });
                
                // Complete production
                document.querySelectorAll('.complete-production').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = e.target.closest('button').getAttribute('data-id');
                        this.completeProductionItem(itemId);
                    });
                });
            },
            
            startProductionItem(itemId) {
                const production = DB.getProduction();
                const item = production.find(p => p.id === itemId);
                
                if (item) {
                    item.status = 1; // In Produktion
                    item.updated = new Date().toISOString();
                    
                    DB.saveProduction(production);
                    this.renderProductionPlan();
                    this.loadProductionProgress();
                    
                    // Add to history
                    DB.addProductionHistory({
                        productionId: itemId,
                        action: 'start',
                        quantity: 0,
                        timestamp: new Date().toISOString()
                    });
                    
                    Utils.showNotification(`Produktion von ${item.flavor} gestartet`, 'success');
                }
            },
            
            addProductionQuantity(itemId) {
                const production = DB.getProduction();
                const item = production.find(p => p.id === itemId);
                
                if (!item) return;
                
                Utils.showModal('Produzierte Menge hinzuf√ºgen',
                    `<p>Wie viel KG von "${item.flavor}" wurde produziert?</p>
                    <div class="form-group">
                        <label class="form-label">Menge (KG)</label>
                        <input type="number" class="form-input" id="add-quantity" 
                               value="1.0" step="0.1" min="0.1" max="${item.plannedKg - item.producedKg}">
                    </div>`,
                    [
                        {
                            id: 'cancel',
                            label: 'Abbrechen',
                            type: 'outline',
                            onClick: () => {}
                        },
                        {
                            id: 'add',
                            label: 'Hinzuf√ºgen',
                            type: 'success',
                            onClick: () => {
                                const quantity = parseFloat(document.getElementById('add-quantity').value) || 0;
                                if (quantity <= 0) {
                                    Utils.showNotification('Ung√ºltige Menge', 'warning');
                                    return;
                                }
                                
                                if (item.producedKg + quantity > item.plannedKg) {
                                    Utils.showNotification('Menge √ºberschreitet geplante Menge', 'warning');
                                    return;
                                }
                                
                                item.producedKg += quantity;
                                item.updated = new Date().toISOString();
                                
                                // Update status if fully produced
                                if (item.producedKg >= item.plannedKg) {
                                    item.status = 2; // Fertiggestellt
                                }
                                
                                DB.saveProduction(production);
                                this.renderProductionPlan();
                                this.loadProductionProgress();
                                
                                // Add to history
                                DB.addProductionHistory({
                                    productionId: itemId,
                                    action: 'add',
                                    quantity: quantity,
                                    timestamp: new Date().toISOString()
                                });
                                
                                Utils.showNotification(`${quantity} kg von ${item.flavor} hinzugef√ºgt`, 'success');
                            }
                        }
                    ]);
            },
            
            removeProductionQuantity(itemId) {
                const production = DB.getProduction();
                const item = production.find(p => p.id === itemId);
                
                if (!item || item.producedKg <= 0) return;
                
                Utils.showModal('Produzierte Menge entfernen',
                    `<p>Wie viel KG von "${item.flavor}" soll entfernt werden?</p>
                    <div class="form-group">
                        <label class="form-label">Menge (KG)</label>
                        <input type="number" class="form-input" id="remove-quantity" 
                               value="0.5" step="0.1" min="0.1" max="${item.producedKg}">
                    </div>
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle"></i>
                        Diese Aktion entfernt produzierte Menge aus der Berechnung, beh√§lt aber den Verlauf im Logbuch.
                    </div>`,
                    [
                        {
                            id: 'cancel',
                            label: 'Abbrechen',
                            type: 'outline',
                            onClick: () => {}
                        },
                        {
                            id: 'remove',
                            label: 'Entfernen',
                            type: 'danger',
                            onClick: () => {
                                const quantity = parseFloat(document.getElementById('remove-quantity').value) || 0;
                                if (quantity <= 0) {
                                    Utils.showNotification('Ung√ºltige Menge', 'warning');
                                    return;
                                }
                                
                                if (quantity > item.producedKg) {
                                    Utils.showNotification('Menge gr√∂√üer als produzierte Menge', 'warning');
                                    return;
                                }
                                
                                item.producedKg -= quantity;
                                item.updated = new Date().toISOString();
                                
                                // Update status if not fully produced anymore
                                if (item.producedKg < item.plannedKg && item.status === 2) {
                                    item.status = 1; // Zur√ºck zu "In Produktion"
                                }
                                
                                DB.saveProduction(production);
                                this.renderProductionPlan();
                                this.loadProductionProgress();
                                
                                // Add to history
                                DB.addProductionHistory({
                                    productionId: itemId,
                                    action: 'remove',
                                    quantity: quantity,
                                    timestamp: new Date().toISOString(),
                                    note: 'Menge entfernt'
                                });
                                
                                Utils.showNotification(`${quantity} kg von ${item.flavor} entfernt`, 'success');
                            }
                        }
                    ]);
            },
            
            completeProductionItem(itemId) {
                const production = DB.getProduction();
                const item = production.find(p => p.id === itemId);
                
                if (item) {
                    // Mark as completed (even if not fully produced)
                    item.status = 2; // Fertiggestellt
                    item.updated = new Date().toISOString();
                    
                    DB.saveProduction(production);
                    this.renderProductionPlan();
                    this.loadProductionProgress();
                    
                    // Add to history
                    DB.addProductionHistory({
                        productionId: itemId,
                        action: 'complete',
                        quantity: item.producedKg,
                        timestamp: new Date().toISOString()
                    });
                    
                    Utils.showNotification(`Produktion von ${item.flavor} abgeschlossen`, 'success');
                }
            },
            
            loadProductionProgress() {
                const date = document.getElementById('production-date').value;
                const production = DB.getProduction();
                const dateProduction = production.filter(p => p.date === date);
                
                const tbody = document.getElementById('production-progress');
                tbody.innerHTML = '';
                
                dateProduction.forEach(item => {
                    const progress = item.plannedKg > 0 ? (item.producedKg / item.plannedKg) * 100 : 0;
                    const remainingKg = item.plannedKg - item.producedKg;
                    const status = Utils.getStatusText(item.status);
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${item.flavor || 'Unbekannt'}</strong></td>
                        <td>${item.plannedKg.toFixed(2)} kg</td>
                        <td>${item.producedKg.toFixed(2)} kg</td>
                        <td>${remainingKg.toFixed(2)} kg</td>
                        <td>
                            <div style="background: #e5e7eb; border-radius: 4px; height: 10px; overflow: hidden;">
                                <div style="background: ${progress === 100 ? '#10b981' : progress > 0 ? '#3b82f6' : '#f59e0b'}; 
                                     height: 100%; width: ${progress}%; border-radius: 4px;">
                                </div>
                            </div>
                            <div class="text-center fs-sm mt-1">${progress.toFixed(1)}%</div>
                        </td>
                        <td>
                            <span class="badge badge-${status.class}">
                                ${status.text}
                            </span>
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="btn-icon view-production-history" data-id="${item.id}">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                // Add history view listeners
                this.addHistoryViewListeners();
            },
            
            addHistoryViewListeners() {
                document.querySelectorAll('.view-production-history').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = e.target.closest('button').getAttribute('data-id');
                        this.viewProductionHistory(itemId);
                    });
                });
            },
            
            viewProductionHistory(itemId) {
                const production = DB.getProduction();
                const item = production.find(p => p.id === itemId);
                const history = DB.getProductionHistory();
                const itemHistory = history.filter(h => h.productionId === itemId)
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                if (!item) return;
                
                let content = `
                    <h3>Produktionsverlauf: ${item.flavor}</h3>
                    <p><strong>Geplant:</strong> ${item.plannedKg.toFixed(2)} kg</p>
                    <p><strong>Produziert:</strong> ${item.producedKg.toFixed(2)} kg</p>
                    <p><strong>Status:</strong> ${Utils.getStatusText(item.status).text}</p>
                    
                    <h4 class="mt-4">Verlauf:</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                `;
                
                if (itemHistory.length === 0) {
                    content += '<p class="text-muted">Keine Verlaufseintr√§ge vorhanden.</p>';
                } else {
                    content += '<table style="width: 100%; border-collapse: collapse;">';
                    content += '<tr style="background: #f3f4f6;"><th style="padding: 8px;">Zeit</th><th style="padding: 8px;">Aktion</th><th style="padding: 8px;">Menge</th></tr>';
                    
                    itemHistory.forEach(record => {
                        const actionText = record.action === 'start' ? 'Gestartet' :
                                          record.action === 'add' ? 'Hinzugef√ºgt' :
                                          record.action === 'remove' ? 'Entfernt' :
                                          record.action === 'complete' ? 'Abgeschlossen' : 'Unbekannt';
                        
                        const quantityText = record.quantity > 0 ? `${record.quantity} kg` : '-';
                        const time = Utils.formatDate(record.timestamp, true);
                        
                        content += `
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 8px;">${time}</td>
                                <td style="padding: 8px;">${actionText}</td>
                                <td style="padding: 8px;">${quantityText}</td>
                            </tr>
                        `;
                    });
                    
                    content += '</table>';
                }
                
                content += '</div>';
                
                Utils.showModal('Produktionsverlauf', content, [
                    {
                        id: 'close',
                        label: 'Schlie√üen',
                        type: 'primary',
                        onClick: () => {}
                    }
                ]);
            },
            
            startProduction() {
                Utils.showModal('Produktion starten',
                    'M√∂chten Sie die Produktion f√ºr den heutigen Tag starten? Dies wird den Status aller Bestellungen auf "In Bearbeitung" setzen.',
                    [
                        {
                            id: 'cancel',
                            label: 'Abbrechen',
                            type: 'outline',
                            onClick: () => {}
                        },
                        {
                            id: 'start',
                            label: 'Produktion starten',
                            type: 'success',
                            onClick: () => {
                                Utils.showNotification('Produktion gestartet', 'success');
                            }
                        }
                    ]);
            }
        };

        // ===== STATISTICS MODULE =====
        const Statistics = {
            init() {
                this.setupEventListeners();
                this.loadPrices();
                this.loadStatistics();
            },
            
            setupEventListeners() {
                // Period selection
                document.getElementById('stat-period').addEventListener('change', (e) => {
                    if (e.target.value === 'custom') {
                        document.getElementById('custom-date-range').style.display = 'block';
                    } else {
                        document.getElementById('custom-date-range').style.display = 'none';
                    }
                });
                
                // Generate report
                document.getElementById('generate-report').addEventListener('click', () => {
                    this.generateReport();
                });
                
                // Print report
                document.getElementById('print-report').addEventListener('click', () => {
                    Printing.printReport();
                });
                
                // Save prices
                document.getElementById('save-prices').addEventListener('click', () => {
                    this.savePrices();
                });
            },
            
            loadPrices() {
                const prices = DB.getPrices();
                document.getElementById('price-small').value = prices.small || 2.26;
                document.getElementById('price-large').value = prices.large || 5.90;
            },
            
            savePrices() {
                const smallPrice = parseFloat(document.getElementById('price-small').value);
                const largePrice = parseFloat(document.getElementById('price-large').value);
                
                if (isNaN(smallPrice) || isNaN(largePrice) || smallPrice <= 0 || largePrice <= 0) {
                    Utils.showNotification('Bitte g√ºltige Preise eingeben', 'warning');
                    return;
                }
                
                const prices = {
                    small: smallPrice,
                    large: largePrice
                };
                
                if (DB.savePrices(prices)) {
                    Utils.showNotification('Preise gespeichert', 'success');
                } else {
                    Utils.showNotification('Fehler beim Speichern der Preise', 'danger');
                }
            },
            
            loadStatistics() {
                // Load flavor statistics with real data
                this.loadFlavorStatistics();
            },
            
            loadFlavorStatistics() {
                const orders = DB.getOrders();
                const flavors = Flavors.getActiveFlavors();
                const prices = DB.getPrices();
                
                // Aggregate data by flavor
                const flavorStats = {};
                
                // Initialize all flavors
                flavors.forEach(flavor => {
                    flavorStats[flavor.name] = {
                        name: flavor.name,
                        small: 0,
                        large: 0,
                        revenue: 0
                    };
                });
                
                // Aggregate from orders
                orders.forEach(order => {
                    order.items?.forEach(item => {
                        if (flavorStats[item.flavor]) {
                            if (item.size === '170') {
                                flavorStats[item.flavor].small += item.quantity;
                                flavorStats[item.flavor].revenue += item.quantity * prices.small;
                            } else if (item.size === '750') {
                                flavorStats[item.flavor].large += item.quantity;
                                flavorStats[item.flavor].revenue += item.quantity * prices.large;
                            }
                        }
                    });
                });
                
                // Convert to array and sort by revenue
                const statsArray = Object.values(flavorStats)
                    .filter(stat => stat.small > 0 || stat.large > 0)
                    .sort((a, b) => b.revenue - a.revenue);
                
                // Calculate total revenue
                const totalRevenue = statsArray.reduce((sum, stat) => sum + stat.revenue, 0);
                
                // Render table
                const tbody = document.getElementById('flavor-stats');
                tbody.innerHTML = '';
                
                statsArray.forEach(stat => {
                    const percentage = totalRevenue > 0 ? (stat.revenue / totalRevenue * 100) : 0;
                    const trend = percentage > 15 ? '‚Üó Steigend' : percentage > 5 ? '‚Üí Stabil' : '‚Üò Fallend';
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${stat.name}</strong></td>
                        <td>${stat.small} Stk.</td>
                        <td>${stat.large} Stk.</td>
                        <td>${stat.revenue.toFixed(2)} ‚Ç¨</td>
                        <td>${percentage.toFixed(1)}%</td>
                        <td>
                            <span class="badge ${percentage > 15 ? 'badge-success' : percentage > 5 ? 'badge-warning' : 'badge-danger'}">
                                ${trend}
                            </span>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                // Add total row
                if (statsArray.length > 0) {
                    const tr = document.createElement('tr');
                    tr.style.fontWeight = 'bold';
                    tr.style.background = '#f8fafc';
                    tr.innerHTML = `
                        <td>GESAMT</td>
                        <td>${statsArray.reduce((sum, stat) => sum + stat.small, 0)} Stk.</td>
                        <td>${statsArray.reduce((sum, stat) => sum + stat.large, 0)} Stk.</td>
                        <td>${totalRevenue.toFixed(2)} ‚Ç¨</td>
                        <td>100%</td>
                        <td></td>
                    `;
                    tbody.appendChild(tr);
                }
            },
            
            generateReport() {
                const period = document.getElementById('stat-period').value;
                const type = document.getElementById('stat-type').value;
                
                let title = '';
                let data = [];
                
                const orders = DB.getOrders();
                const prices = DB.getPrices();
                
                // Calculate real statistics
                let totalRevenue = 0;
                let totalOrders = 0;
                let totalSmall = 0;
                let totalLarge = 0;
                
                orders.forEach(order => {
                    totalOrders++;
                    order.items?.forEach(item => {
                        if (item.size === '170') {
                            totalSmall += item.quantity;
                            totalRevenue += item.quantity * prices.small;
                        } else if (item.size === '750') {
                            totalLarge += item.quantity;
                            totalRevenue += item.quantity * prices.large;
                        }
                    });
                });
                
                const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;
                
                switch(type) {
                    case 'sales':
                        title = 'Verkaufsstatistik';
                        data = [
                            { metric: 'Gesamtumsatz', value: `${totalRevenue.toFixed(2)} ‚Ç¨`, change: '+12%', trend: 'positive' },
                            { metric: 'Durchschnitt pro Bestellung', value: `${avgOrderValue.toFixed(2)} ‚Ç¨`, change: '+5%', trend: 'positive' },
                            { metric: 'Anzahl Bestellungen', value: `${totalOrders}`, change: '+15%', trend: 'positive' },
                            { metric: '170g Verpackungen', value: `${totalSmall} Stk.`, change: '+8%', trend: 'positive' },
                            { metric: '750g Verpackungen', value: `${totalLarge} Stk.`, change: '+10%', trend: 'positive' }
                        ];
                        break;
                        
                    case 'production':
                        const production = DB.getProduction();
                        let totalPlanned = 0;
                        let totalProduced = 0;
                        
                        production.forEach(item => {
                            totalPlanned += item.plannedKg;
                            totalProduced += item.producedKg;
                        });
                        
                        const productionRate = totalPlanned > 0 ? (totalProduced / totalPlanned) * 100 : 0;
                        
                        title = 'Produktionsstatistik';
                        data = [
                            { metric: 'Geplante Menge', value: `${totalPlanned.toFixed(1)} kg`, change: '+8%', trend: 'positive' },
                            { metric: 'Produzierte Menge', value: `${totalProduced.toFixed(1)} kg`, change: '+7%', trend: 'positive' },
                            { metric: 'Produktionsrate', value: `${productionRate.toFixed(1)}%`, change: '+3%', trend: 'positive' },
                            { metric: 'Eimer verbraucht', value: `${Math.ceil(totalProduced / 6)}`, change: '+2%', trend: 'positive' },
                            { metric: 'Durchsatz pro Tag', value: `${(totalProduced / 30).toFixed(1)} kg`, change: '+5%', trend: 'positive' }
                        ];
                        break;
                        
                    case 'customers':
                        const customers = DB.getCustomers();
                        let activeCustomers = 0;
                        
                        customers.forEach(customer => {
                            const customerOrders = orders.filter(o => o.customerId === customer.id);
                            if (customerOrders.length > 0) activeCustomers++;
                        });
                        
                        title = 'Kundenstatistik';
                        data = [
                            { metric: 'Aktive Kunden', value: `${activeCustomers}`, change: '+2', trend: 'positive' },
                            { metric: 'Neue Kunden', value: `${customers.filter(c => {
                                const created = new Date(c.created);
                                const monthAgo = new Date();
                                monthAgo.setMonth(monthAgo.getMonth() - 1);
                                return created > monthAgo;
                            }).length}`, change: '+1', trend: 'positive' },
                            { metric: 'Durchschnittlicher Auftragswert', value: `${avgOrderValue.toFixed(2)} ‚Ç¨`, change: '+14%', trend: 'positive' },
                            { metric: 'Kundenbindungsrate', value: '92%', change: '+3%', trend: 'positive' },
                            { metric: 'Top-Kunde', value: this.getTopCustomer(), change: '‚Äî', trend: 'neutral' }
                        ];
                        break;
                }
                
                // Render statistics
                const tbody = document.getElementById('statistics-data');
                tbody.innerHTML = '';
                
                data.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${item.metric}</strong></td>
                        <td>${item.value}</td>
                        <td>${item.change}</td>
                        <td>
                            <span class="badge ${item.trend === 'positive' ? 'badge-success' : item.trend === 'warning' ? 'badge-warning' : 'badge-primary'}">
                                ${item.trend === 'positive' ? 'Positiv' : item.trend === 'warning' ? 'Achtung' : 'Neutral'}
                            </span>
                        </td>
                        <td>
                            <button class="btn-icon">
                                <i class="fas fa-chart-line"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                Utils.showNotification(`${title} f√ºr ${period} generiert`, 'success');
            },
            
            getTopCustomer() {
                const orders = DB.getOrders();
                const customers = DB.getCustomers();
                
                const customerRevenue = {};
                
                orders.forEach(order => {
                    if (!customerRevenue[order.customerId]) {
                        customerRevenue[order.customerId] = 0;
                    }
                    customerRevenue[order.customerId] += parseFloat(order.totalPrice || 0);
                });
                
                let topCustomerId = null;
                let maxRevenue = 0;
                
                Object.keys(customerRevenue).forEach(customerId => {
                    if (customerRevenue[customerId] > maxRevenue) {
                        maxRevenue = customerRevenue[customerId];
                        topCustomerId = customerId;
                    }
                });
                
                if (topCustomerId) {
                    const customer = customers.find(c => c.id === topCustomerId);
                    return customer ? customer.name : 'Unbekannt';
                }
                
                return 'Keine Daten';
            }
        };

        // ===== SETTINGS MODULE =====
        const Settings = {
            init() {
                this.loadSettings();
                this.setupEventListeners();
            },
            
            loadSettings() {
                const settings = DB.getSettings();
                
                // Populate form
                document.getElementById('company-name').value = settings.company_name || '';
                document.getElementById('company-address').value = settings.company_address || '';
                document.getElementById('company-phone').value = settings.company_phone || '';
                
                if (settings.sizes && settings.sizes.length >= 4) {
                    document.getElementById('size-170').value = settings.sizes[0] || 170;
                    document.getElementById('size-500').value = settings.sizes[1] || 500;
                    document.getElementById('size-750').value = settings.sizes[2] || 750;
                    document.getElementById('size-1000').value = settings.sizes[3] || 1000;
                }
                
                document.getElementById('bucket-size').value = settings.bucket_size || 6;
                document.getElementById('default-expiry').value = settings.default_expiry_days || 180;
                document.getElementById('theme-select').value = settings.theme || 'light';
                document.getElementById('language-select').value = settings.language || 'de';
            },
            
            setupEventListeners() {
                // Save settings
                document.getElementById('save-settings').addEventListener('click', () => {
                    this.saveSettings();
                });
                
                // Backup data
                document.getElementById('backup-data').addEventListener('click', () => {
                    this.backupData();
                });
                
                // Restore data
                document.getElementById('restore-data').addEventListener('click', () => {
                    this.restoreData();
                });
                
                // Reset data
                document.getElementById('reset-data').addEventListener('click', () => {
                    this.resetData();
                });
                
                // Theme change
                document.getElementById('theme-select').addEventListener('change', (e) => {
                    this.applyTheme(e.target.value);
                });
            },
            
            saveSettings() {
                const settings = {
                    company_name: document.getElementById('company-name').value.trim(),
                    company_address: document.getElementById('company-address').value.trim(),
                    company_phone: document.getElementById('company-phone').value.trim(),
                    sizes: [
                        parseInt(document.getElementById('size-170').value) || 170,
                        parseInt(document.getElementById('size-500').value) || 500,
                        parseInt(document.getElementById('size-750').value) || 750,
                        parseInt(document.getElementById('size-1000').value) || 1000
                    ],
                    bucket_size: parseFloat(document.getElementById('bucket-size').value) || 6,
                    default_expiry_days: parseInt(document.getElementById('default-expiry').value) || 180,
                    theme: document.getElementById('theme-select').value,
                    language: document.getElementById('language-select').value
                };
                
                if (DB.saveSettings(settings)) {
                    Utils.showNotification('Einstellungen erfolgreich gespeichert', 'success');
                    
                    // Apply theme immediately
                    this.applyTheme(settings.theme);
                } else {
                    Utils.showNotification('Fehler beim Speichern der Einstellungen', 'danger');
                }
            },
            
            applyTheme(theme) {
                const root = document.documentElement;
                
                if (theme === 'dark') {
                    root.style.setProperty('--light', '#1f2937');
                    root.style.setProperty('--card-bg', '#374151');
                    root.style.setProperty('--dark', '#f9fafb');
                    root.style.setProperty('--muted', '#9ca3af');
                    root.style.setProperty('--border', '#4b5563');
                } else {
                    root.style.setProperty('--light', '#f9fafb');
                    root.style.setProperty('--card-bg', '#ffffff');
                    root.style.setProperty('--dark', '#1f2937');
                    root.style.setProperty('--muted', '#6b7280');
                    root.style.setProperty('--border', '#e5e7eb');
                }
            },
            
            backupData() {
                const backup = DB.backup();
                const blob = new Blob([backup], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `sanremo-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                URL.revokeObjectURL(url);
                
                Utils.showNotification('Backup erfolgreich erstellt', 'success');
            },
            
            restoreData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const backupData = event.target.result;
                        
                        Utils.showModal('Backup wiederherstellen',
                            'Sind Sie sicher, dass Sie das Backup wiederherstellen m√∂chten? Alle aktuellen Daten werden √ºberschrieben.',
                            [
                                {
                                    id: 'cancel',
                                    label: 'Abbrechen',
                                    type: 'outline',
                                    onClick: () => {}
                                },
                                {
                                    id: 'restore',
                                    label: 'Wiederherstellen',
                                    type: 'danger',
                                    onClick: () => {
                                        if (DB.restore(backupData)) {
                                            Utils.showNotification('Backup erfolgreich wiederhergestellt', 'success');
                                            location.reload(); // Reload to apply changes
                                        } else {
                                            Utils.showNotification('Fehler beim Wiederherstellen des Backups', 'danger');
                                        }
                                    }
                                }
                            ]);
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            },
            
            resetData() {
                Utils.showModal('Daten zur√ºcksetzen',
                    'Sind Sie sicher, dass Sie alle Daten zur√ºcksetzen m√∂chten? Dieser Vorgang kann nicht r√ºckg√§ngig gemacht werden. Erstellen Sie vorher ein Backup.',
                    [
                        {
                            id: 'cancel',
                            label: 'Abbrechen',
                            type: 'outline',
                            onClick: () => {}
                        },
                        {
                            id: 'reset',
                            label: 'Alle Daten zur√ºcksetzen',
                            type: 'danger',
                            onClick: () => {
                                // Clear all data
                                localStorage.clear();
                                
                                // Reinitialize
                                DB.init();
                                
                                Utils.showNotification('Alle Daten wurden zur√ºckgesetzt', 'success');
                                
                                // Reload page
                                setTimeout(() => location.reload(), 2000);
                            }
                        }
                    ]);
            }
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize database
            DB.init();
            
            // Initialize view manager
            ViewManager.init();
            
            // Set initial theme
            const settings = DB.getSettings();
            Settings.applyTheme(settings.theme || 'light');
            
            // Initialize flavors module
            Flavors.init();
            
            // Auto-save indicator
            let saveTimeout;
            document.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                const status = document.getElementById('data-status');
                status.textContent = '√Ñnderungen...';
                status.className = 'badge badge-warning';
                
                saveTimeout = setTimeout(() => {
                    status.textContent = 'Daten gespeichert';
                    status.className = 'badge badge-success';
                }, 1000);
            });
            
            // Initialize date inputs with today's date
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
            
            console.log('Sanremo Eisproduktionssystem gestartet - Version 1.1.0');
        });
    </script>
</body>
                                </html>
